<MvCOMMENT>
|
| Miva Merchant v4.x
|
| This file and the source codes contained herein are the property 
| of Miva Corporation.  Use of this file is restricted to the specific 
| terms and conditions in the License Agreement associated with this 
| file.  Distribution of this file or portions of this file for uses
| not covered by the License Agreement is not allowed without a written 
| agreement signed by an officer of Miva Corporation.
| 
| Copyright 1998-2004 Miva Corporation.  All rights reserved.
| http://www.miva.com/
|
| Export Store to Miva Merchant 5.x
| $Source: /home/cvs/merchant/Merchant/modules/export/Attic/upgrade5.mv,v $
|
| Prefix         : MER-UP5-
| Next Error Code:     
|
</MvCOMMENT>

<MvCOMMENT>
Store Settings (name, code, etc...)
	- StoreCreate
		done - Identification
		done - Owner
		done - Settings
(everything else falls under a store_update)
	- Maintenance Mode
	- Order Minimums
	- Customer Fields
	done - Inventory
		done - Global Settings
		done - Email Notification Settings
	done - Affiliates
		done - Options
		done - Lost Password Email
		done - Affiliate Email Notification
	done - Customers
		done - Lost Password Email
	done - Upsale
		done - Settings
done Groups
	done - Groups themselves w/permissions
	done - Users in groups
done Store Countries
done Store States
done Attribute Templates (must happen before products)
done Categories
done Products
	done - Do CategoryXProduct Assignment on a Product basis rather than category?
	done - Attributes
	done - Inventory Settings
done Related Products (has to be done after all products are created)
Marketing (should this be done?  maybe not--require user to set up new account for new store)
	- Miva Mailer
	- Miva Submit
	- Miva Marketplace
done Upsale
	done - Upsold Products
		done - Required Products
done Actual Affiliates
done Actual Customers
done Availability Groups
	done - Groups
	done - Products within Group
	done - Categories within Group
	done - Customers within Group
done Price Groups
	done - Groups
	done - Products within Group
	done - Customers within Group

Modules -- based on code either use built-in export or call into the module
</MvCOMMENT>

<MvFUNCTION NAME = "Module_Type" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "EXPORT">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Code" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "upgrade5">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Name" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "Export Store to Miva Merchant 5.x">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Provider" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "Miva Corporation">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_API_Version" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "4.10">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Version" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "4.2401">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Is_Wizardable" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "0">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Wizard_Predefined_Available" PARAMETERS = "version, description, delimiter, data" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "0">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Wizard_Predefined_Validate" PARAMETERS = "version, description, delimiter, data" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "1">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Wizard_Predefined_Action" PARAMETERS = "version, description, delimiter, data" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "1">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Install" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Upgrade" PARAMETERS = "version" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Upgrade5_Store" PARAMETERS = "version" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Uninstall" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Domain_Validate" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Domain_Update" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Domain_Tabs" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Domain_Content" PARAMETERS = "tab, load_fields" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ExportModule_Validate" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "g.Upgrade5_File" VALUE = "{ ltrim( rtrim( g.Upgrade5_File ) ) }">

	<MvIF EXPR = "{ len( g.Upgrade5_File ) EQ 0 }">
		<MvASSIGN NAME = "g.Upgrade5_Screen" VALUE = "">
		<MvDO FILE = "{ g.Module_Admin }" NAME = "l.null" VALUE = "{ FieldError( '', 'Upgrade5_File', 'Please specify a file' ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	<MvELSE>
		<MvIF EXPR = "{ '/' IN g.Upgrade5_File }">
			<MvASSIGN NAME = "g.Upgrade5_Screen" VALUE = "">
			<MvDO FILE = "{ g.Module_Admin }" NAME = "l.null" VALUE = "{ FieldError( '', 'Upgrade5_File', 'Please do not include a path in the file name' ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ExportModule_Export" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "syntax, expression">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ExportModule_Screen" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<MvIF EXPR = "{ g.Upgrade5_Screen EQ 'MXSF' }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Screen_Frameset() }">
	<MvELSE> <MvIF EXPR = "{ g.Upgrade5_Screen EQ 'MXSW' }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Screen_Work() }">
	<MvELSE> <MvIF EXPR = "{ g.Upgrade5_Screen EQ 'MXSI' }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Screen_Info() }">
	</MvIF> </MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Screen_Configuration() }">
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Screen_Frameset" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<head><title>Export Progress</title></head>

	<frameset rows="*, 100, 1" border=1>
		<frame name="Progress"	src="{ g.sessionurl $ 'Screen=BLNK' }" noresize>
		<frame name="Work"		src="{ g.sessionurl $ 'Screen=' $ encodeattribute( g.Screen ) $ '&Store_Code=' $ encodeattribute( g.Store_Code ) $ '&Module_Code=' $ encodeattribute( g.Module_Code ) $ '&Upgrade5_Screen=MXSW&Upgrade5_File=' $ encodeattribute( g.Upgrade5_File ) }" noresize>
		<frame name="Info"		src="{ g.sessionurl $ 'Screen=' $ encodeattribute( g.Screen ) $ '&Store_Code=' $ encodeattribute( g.Store_Code ) $ '&Module_Code=' $ encodeattribute( g.Module_Code ) $ '&Upgrade5_Screen=MXSI' }" noresize>

		<noframes>Export Store to Miva Merchant 5.x requires a browser that supports frames</noframes>
	</frameset>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Screen_Work" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<head><title>Export: Work</title></head>
	<body bgcolor="#ffffff" onload="Upgrade5_Refresh();">

	<MvASSIGN NAME = "g.Upgrade5_Module" VALUE = "{ Modules.d.module }">

	<MvIF EXPR = "{ NOT g.Upgrade5_Initialized }">
		<MvIF EXPR = "{ NOT Upgrade5_Initialize() }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvCOMMENT>
	|
	| *ALWAYS* run through at least one iteration, in case the global timeout is less than 5
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ g.Upgrade5_Step LE g.Upgrade5_Step_Count }">
		<MvASSIGN NAME = "l.result"				VALUE = "{ Upgrade5_Step( g.Upgrade5_Steps[ g.Upgrade5_Step ] ) }">
	 
		<MvIF EXPR = "{ l.result EQ -1 }">
			<MvFUNCTIONRETURN VALUE = 1>
		<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
			<MvASSIGN NAME = "g.Upgrade5_Step"  VALUE = "{ g.Upgrade5_Step + 1 }">
		</MvIF> </MvIF>
	</MvIF>

	<MvWHILE EXPR = "{ ( ( s.dyn_time_remaining EQ -1 ) OR ( s.dyn_time_remaining GT 5 ) ) AND
					   ( g.Upgrade5_Step LE g.Upgrade5_Step_Count ) AND
					   ( NOT g.Upgrade5_Flush ) }">
		<MvASSIGN NAME = "l.result"				VALUE = "{ Upgrade5_Step( g.Upgrade5_Steps[ g.Upgrade5_Step ] ) }">
	 
		<MvIF EXPR = "{ l.result EQ -1 }">
			<MvFUNCTIONRETURN VALUE = 1>
		<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
			<MvASSIGN NAME = "g.Upgrade5_Step"  VALUE = "{ g.Upgrade5_Step + 1 }">
		</MvIF> </MvIF>
	</MvWHILE>
 
	<form name="{ g.Screen }" method="POST" action="{ g.sessionurl }">
	<MvHIDE FIELDS = "g.Screen, g.Upgrade5_Screen, g.Store_Code, g.Module_Code, g.Upgrade5_File, g.Upgrade5_Initialized, g.Upgrade5_Steps, g.Upgrade5_Step_Count, g.Upgrade5_Step">
	</form>

	<MvIF EXPR = "{ g.Upgrade5_Step LE g.Upgrade5_Step_Count }">
		<MvDO FILE = "{ g.Module_Admin }" NAME = "l.code" VALUE = "{ JavaScript_SetVariables( 'g', 'Screen' ) }">
		<MvEVAL EXPR = "{ l.code }">
<script language="JavaScript">
<!--
function Upgrade5_Refresh()
{
	document.forms[ Screen ].submit();
}
//-->
</script>
	<MvELSE>
<script language="JavaScript">
<!--
function Upgrade5_Refresh()
{
	parent.Info.Upgrade5_Complete( parent.Progress.document );
}
//-->
</script>
	</MvIF>
	</body>
	
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Screen_Info" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<head><title>Export: Information</title></head>
	<body bgcolor="#ffffff" onload="Upgrade5_Loaded();">

	<MvASSIGN NAME = "g.CheckImageURL"			VALUE = "{ g.baseurl $ g.AdminGraphics_Path $ 'check.gif' }">

	<MvDO FILE = "{ g.Module_Admin }" NAME = "l.script" VALUE = "{ JavaScript_SetVariables( 'g', 'CheckImageURL' ) }">
	<MvEVAL EXPR = "{ l.script }">

<script language="JavaScript">
<!--
var Steps = new Array(
	{ code:"init",				text:"Initializing" },
	{ code:"store_settings",	text:"Store Settings" },
	{ code:"groups",			text:"Groups and Users" },
	{ code:"countries",			text:"Countries" },
	{ code:"states",			text:"States" },
	{ code:"atemplates",		text:"Attribute Templates" },
	{ code:"categories",		text:"Categories" },
	{ code:"catparents",		text:"Category Hierarchy" },
	{ code:"products",			text:"Products" },
	{ code:"relprod",			text:"Related Products" },
	{ code:"upsale",			text:"Upsold Product Settings" },
	{ code:"affiliates",		text:"Affiliates" },
	{ code:"customers",			text:"Customers" },
	{ code:"availgroups",		text:"Availability Groups" },
	{ code:"pricegroups",		text:"Price Groups" },
	{ code:"modules",			text:"Module Settings" }
);

var loaded = 0;

function Upgrade5_Loaded()
{
	loaded = 1;
	Upgrade5_Draw_Status( parent.Progress.document, 'init', 0, 0 );
}

function Upgrade5_Complete( output_document )
{
	output_document.open( 'text/html', 1 );
	output_document.writeln( '<html><body bgcolor="#ffffff">' );
	output_document.writeln( '<table border=0 cellspacing=0 cellpadding=2>' );

	// Output finished steps
	for ( i = 0; i < Steps.length; i++ )
	{
		output_document.writeln( '<tr>' );
		output_document.writeln( '	<td><img src="' + CheckImageURL + '"></td>' );
		output_document.writeln( '	<td><font face="arial, helvetica" size="-1">' + Steps[ i ].text + '</font></td>' );
		output_document.writeln( '</tr>' );
	}

	output_document.writeln( '<tr>' );
	output_document.writeln( '	<td><img src="' + CheckImageURL + '"></td>' );
	output_document.writeln( '	<td><font face="arial, helvetica"><b>Export Complete</b></font></td>' );
	output_document.writeln( '</tr>' );

	output_document.writeln( '</table>' );
	output_document.writeln( '</body></html>' );
	output_document.close();
}

function Upgrade5_Draw_Status( output_document, code, offset, totrec )
{
	output_document.open( 'text/html', 1 );
	output_document.writeln( '<html><body bgcolor="#ffffff">' );
	output_document.writeln( '<table border=0 cellspacing=0 cellpadding=2>' );

	// Output finished steps
	for ( i = 0; i < Steps.length; i++ )
	{
		if ( Steps[ i ].code == code )	break;

		output_document.writeln( '<tr>' );
		output_document.writeln( '	<td><img src="' + CheckImageURL + '"></td>' );
		output_document.writeln( '	<td><font face="arial, helvetica" size="-1">' + Steps[ i ].text + '</font></td>' );
		output_document.writeln( '</tr>' );
	}

	// Output current step
	output_document.writeln( '<tr>' );
	output_document.writeln( '	<td>&nbsp;</td>' );

	if ( totrec )	output_document.writeln( '	<td><font face="arial, helvetica" size="-1"><b>' + Steps[ i ].text + '</b> (' + offset + '/' + totrec + ')</font></td>' );
	else			output_document.writeln( '	<td><font face="arial, helvetica" size="-1"><b>' + Steps[ i ].text + '</b></font></td>' );

	output_document.writeln( '</tr>' );

	// Output unfinished steps
	for ( i++; i < Steps.length; i++ )
	{
		if ( Steps[ i ].code == code )	break;

		output_document.writeln( '<tr>' );
		output_document.writeln( '	<td>&nbsp;</td>' );
		output_document.writeln( '	<td><font face="arial, helvetica" size="-1" color="gray">' + Steps[ i ].text + '</font></td>' );
		output_document.writeln( '</tr>' );
	}

	output_document.writeln( '</table>' );
	output_document.writeln( '</body></html>' );
	output_document.close();
}
//-->
</script>
	
	<MvEVAL EXPR = "{ Upgrade5_Status( 'init', 0, 0 ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Screen_Configuration" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<MvIF EXPR = "{ g.Load_Fields }">
		<MvASSIGN NAME = "g.Upgrade5_File" VALUE = "provide.xml">
	</MvIF>

	<MvDO FILE = "{ g.Module_Admin }" NAME = "l.null" VALUE = "{ BeginScreen( 'Miva Merchant: Export Store', 'MXST', 'Help:mxst.html' ) }">
	<MvDO FILE = "{ g.Module_Admin }" NAME = "l.null" VALUE = "{ BeginContent() }">

	<input type="hidden" name="Module_Code" 		value="{ encodeentities( g.Module_Code ) }">
	<input type="hidden" name="Upgrade5_Screen" 	value="MXSF">

	<table border=0 cellpadding = 2 cellspacing = 0 width = "100%">
	<tr><td nowrap>
		<font face="Arial, Helvetica" size=-1>
		<b>Export Store to File:</b>
		</font>
	</td><td width="100%">
		<font face="Arial, Helvetica" size=-1><b>
		<input type="text" name="Upgrade5_File" size=40 value = "{ encodeentities( g.Upgrade5_File ) }">
		</font></b>
	</td></tr>
	</table>

	<MvDO FILE = "{ g.Module_Admin }" NAME = "l.ok" VALUE = "{ EndContent() }">
	<MvDO FILE = "{ g.Module_Admin }" NAME = "l.ok" VALUE = "{ DrawButtons( 'EXPT:Export' ) }">
	<MvDO FILE = "{ g.Module_Admin }" NAME = "l.ok" VALUE = "{ EndScreen() }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Initialize" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "g.Upgrade5_Step_Count"	VALUE = 0>
	<MvASSIGN NAME = "g.Upgrade5_Step"			VALUE = 1>
	<MvASSIGN NAME = "g.Upgrade5_Initialized"	VALUE = 1>

	<MvASSIGN NAME = "l.directory"				VALUE = "{ g.MerchantPath $ padl( Stores.d.id, 8, '0' ) $ '/export/' }">
	<MvIF EXPR = "{ NOT fexists( l.directory ) }">
		<MvIF EXPR = "{ NOT fmkdir( l.directory ) }">
			<MvDO FILE = "{ g.Module_Library_Utilities }" NAME = "l.null" VALUE = "{ Error( '#Error#', 'Unable to create directory \'' $ l.directory $ '\'' ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvASSIGN NAME = "g.Upgrade5_File"			VALUE = "{ l.directory $ g.Upgrade5_File }">	
	<MvASSIGN NAME = "l.deleted"				VALUE = "{ fdelete( g.Upgrade5_File ) }">

	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "provision_start">	<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "store_create">		<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "store_start">		<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "store_config">		<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "groups">			<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "countries">		<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "states">			<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "atemplates">		<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "categories">		<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "catparents">		<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "products">			<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "relprod">			<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "upsale">			<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "affiliates">		<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "customers">		<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "availgroups">		<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "pricegroups">		<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "modules">			<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "store_end">		<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">
	<MvASSIGN NAME = "g.Upgrade5_Steps" INDEX = "{ g.Upgrade5_Step_Count + 1 }" MEMBER = "code" VALUE = "provision_end">	<MvASSIGN NAME = "g.Upgrade5_Step_Count" VALUE = "{ g.Upgrade5_Step_Count + 1 }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.step:code EQ 'provision_start' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Provision_Start( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'store_create' }">	<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Store_Create( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'store_start' }">	<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Store_Start( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'store_config' }">	<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Store_Config( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'groups' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Groups( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'countries' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Countries( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'states' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_States( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'categories' }">	<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Categories( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'catparents' }">	<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Category_Parents( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'products' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Products( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'relprod' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_RelatedProducts( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'atemplates' }">	<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_AttributeTemplates( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'upsale' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Upsale( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'affiliates' }">	<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Affiliates( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'customers' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Customers( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'availgroups' }">	<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_AvailabilityGroups( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'pricegroups' }">	<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_PriceGroups( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'modules' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Modules( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'store_end' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Store_End( l.step ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:code EQ 'provision_end' }">	<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Provision_End( l.step ) }">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = -1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Provision_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '<Provision>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Create" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Status( 'store_settings', 1, 2 ) }">

	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "store_create_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "identification">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "registration">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "store_create_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'store_create_start' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_Create_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'identification' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_Identification( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'registration' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_Registration( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'store_create_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_Create_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																						<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Create_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '	<Domain>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Store_Create>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Identification" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.user_found" 		VALUE = "{ User_Find_ID( Stores.d.manager_id ) }">
	<MvIF EXPR = "{ NOT l.user_found }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Code>'					$ Stores.d.code 	$ '</Code>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Name>'					$ Stores.d.name 	$ '</Name>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Manager>'				$ Users.d.name 		$ '</Manager>' ) }">

	<MvIF EXPR = "{ Stores.d.license NE Domain.d.license }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LicenseNumber>'	$ Stores.d.license 	$ '</LicenseNumber>' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Registration" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Owner>'	$ Stores.d.owner	$ '</Owner>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Email>'	$ Stores.d.email	$ '</Email>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Company>'	$ Stores.d.company	$ '</Company>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Address>' 	$ Stores.d.address 	$ '</Address>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<City>' 	$ Stores.d.city 	$ '</City>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<State>' 	$ Stores.d.state 	$ '</State>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Zip>' 		$ Stores.d.zip 		$ '</Zip>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Country>' 	$ Stores.d.country	$ '</Country>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Phone>' 	$ Stores.d.phone 	$ '</Phone>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Fax>' 		$ Stores.d.fax 		$ '</Fax>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.tax_found" 		VALUE = "{ Module_Find_ID( Stores.d.tax_id ) }">
	<MvIF EXPR = "{ NOT l.tax_found }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	<MvELSE>
		<MvASSIGN NAME = "l.tax_module" 								VALUE = "{ Modules.d.code }">
	</MvIF>

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.currency_found" 	VALUE = "{ Module_Find_ID( Stores.d.currncy_id ) }">
	<MvIF EXPR = "{ NOT l.currency_found }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	<MvELSE>
		<MvASSIGN NAME = "l.currency_module" 							VALUE = "{ Modules.d.code }">
	</MvIF>

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.ui_found" 			VALUE = "{ Module_Find_ID( Stores.d.ui_id ) }">
	<MvIF EXPR = "{ NOT l.ui_found }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	<MvELSE>
		<MvASSIGN NAME = "l.ui_module" 									VALUE = "{ Modules.d.code }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<WeightUnits>' 					$ Stores.d.wtunits							$ '</WeightUnits>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BasketTimeout>' 				$ Stores.d.baskexp							$ '</BasketTimeout>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<PriceGroupOverlap>' 			$ Stores.d.pgrp_ovlp						$ '</PriceGroupOverlap>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<FirstOrderNumber>'		  		$ '1000'									$ '</FirstOrderNumber>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<SalesTaxModule>' 				$ l.tax_module								$ '</SalesTaxModule>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<CurrencyModule>' 				$ l.currency_module							$ '</CurrencyModule>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<RequireShipping>' 				$ Upgrade5_Boolean( Stores.d.req_ship ) 	$ '</RequireShipping>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<RequireTax>' 					$ Upgrade5_Boolean( Stores.d.req_tax )		$ '</RequireTax>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<RequireShippingForFreeOrders>' $ Upgrade5_Boolean( Stores.d.req_frship )	$ '</RequireShippingForFreeOrders>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<UserInterface>' 				$ l.ui_module								$ '</UserInterface>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Create_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Store_Create>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '	</Domain>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '	<Store code="' $ Stores.d.code $ '">' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Config" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Status( 'store_settings', 2, 2 ) }">

	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "maintenance">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "ordermins">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "custfields">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "inventory">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "affiliates">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "customers">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "upsale">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'maintenance' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_Maintenance( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'ordermins' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_OrderMinimums( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'custfields' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_CustomerFields( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'inventory' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_Inventory( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'affiliates' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_Affiliates( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'customers' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_Customers( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'upsale' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_Upsale( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Maintenance" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_OrderMinimums" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_CustomerFields" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.settings_loaded" VALUE = "{ Get_StandardFields() }">
	<MvIF EXPR = "{ NOT l.settings_loaded }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<CustomerFields_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Billing>' 		$ CustomerFields_Mode( StandardFields.d.billing )		$ '</Billing>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<FirstName>' 	$ CustomerFields_Mode( StandardFields.d.mode_fname )	$ '</FirstName>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LastName>'		$ CustomerFields_Mode( StandardFields.d.mode_lname )	$ '</LastName>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Email>'		$ CustomerFields_Mode( StandardFields.d.mode_email )	$ '</Email>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Phone>'		$ CustomerFields_Mode( StandardFields.d.mode_phone )	$ '</Phone>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Fax>'			$ CustomerFields_Mode( StandardFields.d.mode_fax )		$ '</Fax>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Company>'		$ CustomerFields_Mode( StandardFields.d.mode_comp )		$ '</Company>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Address>'		$ CustomerFields_Mode( StandardFields.d.mode_addr )		$ '</Address>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<City>'			$ CustomerFields_Mode( StandardFields.d.mode_city )		$ '</City>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<State>'		$ CustomerFields_Mode( StandardFields.d.mode_state )	$ '</State>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Zip>'			$ CustomerFields_Mode( StandardFields.d.mode_zip )		$ '</Zip>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Country>'		$ CustomerFields_Mode( StandardFields.d.mode_cntry )	$ '</Country>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</CustomerFields_Update>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CustomerFields_Mode" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.code" VALUE = "{ tolower( l.code ) }">

	<MvIF EXPR = "{ l.code EQ 'h' }">			<MvFUNCTIONRETURN VALUE = "Hidden">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'o' }">	<MvFUNCTIONRETURN VALUE = "Optional">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'r' }">	<MvFUNCTIONRETURN VALUE = "Required">
	</MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Inventory" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Feature_INV_DB }" NAME = "l.settings_loaded" VALUE = "{ INV_InventorySettings_Find() }">
	<MvIF EXPR = "{ NOT l.settings_loaded }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<InventorySettings_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<TrackInventory>'					$ Upgrade5_Boolean( InventorySettings.d.active )	$ '</TrackInventory>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<InStockMessageShort><![CDATA[' 	$ InventorySettings.d.in_short						$ ']]></InStockMessageShort>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<InStockMessageLong><![CDATA['		$ InventorySettings.d.in_long						$ ']]></InStockMessageLong>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<TrackLowStockLevel>'				$ Upgrade5_Boolean( InventorySettings.d.low_track )	$ '</TrackLowStockLevel>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LowStockLevel>'					$ InventorySettings.d.low_level						$ '</LowStockLevel>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LowStockMessageShort><![CDATA['	$ InventorySettings.d.low_short						$ ']]></LowStockMessageShort>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LowStockMessageLong><![CDATA['		$ InventorySettings.d.low_long						$ ']]></LowStockMessageLong>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<TrackOutOfStockProducts>'			$ Upgrade5_Boolean( InventorySettings.d.out_track )	$ '</TrackOutOfStockProducts>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<TrackOutOfStockLevel>'				$ InventorySettings.d.out_level						$ '</TrackOutOfStockLevel>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<HideOutOfStockProducts>'			$ Upgrade5_Boolean( InventorySettings.d.out_hide )	$ '</HideOutOfStockProducts>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<OutOfStockMessageShort><![CDATA['	$ InventorySettings.d.out_short						$ ']]></OutOfStockMessageShort>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<OutOfStockMessageLong><![CDATA['	$ InventorySettings.d.out_long						$ ']]></OutOfStockMessageLong>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LimitedStockMessage><![CDATA['		$ InventorySettings.d.ltd_long						$ ']]></LimitedStockMessage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</InventorySettings_Update>' ) }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<InventoryEmailNotification_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<SendEmailOnLowStock>' 	$ Upgrade5_Boolean( InventorySettings.d.eml_low )	$ '</SendEmailOnLowStock>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<SendEmailOnNoStock>' 	$ Upgrade5_Boolean( InventorySettings.d.eml_out )	$ '</SendEmailOnNoStock>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EmailFrom>'			$ InventorySettings.d.eml_from						$ '</EmailFrom>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EmailTo>'				$ InventorySettings.d.eml_to						$ '</EmailTo>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EmailCC>'				$ InventorySettings.d.eml_cc						$ '</EmailCC>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Subject>'				$ InventorySettings.d.eml_sub						$ '</Subject>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Message>'				$ InventorySettings.d.eml_msg						$ '</Message>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</InventoryEmailNotification_Update>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Affiliates" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "options">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "lostpw">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "notification">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'options' }">					<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_Affiliate_Options( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'lostpw' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_Affiliate_LostPasswordEmail( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'notification' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Store_Affiliate_Notification( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Affiliate_Options" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Feature_AFF_DB }" NAME = "l.options_found" VALUE = "{ AffiliateOptions_Find() }">
	<MvIF EXPR = "{ NOT l.options_found }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<AffiliateOptions_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Active>'							$ Upgrade5_Boolean( AffiliateOptions.d.active )	$ '</Active>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ApplicationStatus>'				$ Affiliate_Status( AffiliateOptions.d.signup )	$ '</ApplicationStatus>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<DefaultCommissionHit>' 			$ AffiliateOptions.d.hits 						$ '</DefaultCommissionHit>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<DefaultCommissionPercentOfOrder>' 	$ AffiliateOptions.d.percent 					$ '</DefaultCommissionPercentOfOrder>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<DefaultCommissionOrderFlatFee>' 	$ AffiliateOptions.d.flat 						$ '</DefaultCommissionOrderFlatFee>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<PayoutThreshold>'					$ AffiliateOptions.d.pay_thresh					$ '</PayoutThreshold>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LinkImage>'						$ AffiliateOptions.d.link_image					$ '</LinkImage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LinkText>'							$ AffiliateOptions.d.link_text					$ '</LinkText>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Terms>'							$ AffiliateOptions.d.terms						$ '</Terms>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</AffiliateOptions_Update>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Affiliate_Status" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.code" VALUE = "{ tolower( l.code ) }">

	<MvIF EXPR = "{ l.code EQ 'a' }">			<MvFUNCTIONRETURN VALUE = "Approved">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'i' }">	<MvFUNCTIONRETURN VALUE = "Disabled">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'p' }">	<MvFUNCTIONRETURN VALUE = "Pending">
	<MvELSE>									<MvFUNCTIONRETURN VALUE = "Rejected">	
	</MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Affiliate_LostPasswordEmail" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Feature_AFF_DB }" NAME = "l.email_loaded" VALUE = "{ AffiliateEmail_Load() }">
	<MvIF EXPR = "{ NOT l.email_loaded }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<AffiliateLostPasswordEmail_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EmailFrom>'	$ AffiliateEmail.d.from		$ '</EmailFrom>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EmailCC>'		$ AffiliateEmail.d.cc		$ '</EmailCC>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Subject>'		$ AffiliateEmail.d.subject	$ '</Subject>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<HeaderText>'	$ AffiliateEmail.d.header	$ '</HeaderText>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</AffiliateLostPasswordEmail_Update>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Affiliate_Notification" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Feature_AFF_DB }" NAME = "l.email_loaded" VALUE = "{ AffiliateManage_EmailLoad() }">
	<MvIF EXPR = "{ NOT l.email_loaded }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<AffiliateEmailNotification_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<SendEmailOnAffiliateSignups>' 			$ Upgrade5_Boolean( AffiliateManage.d.active )	$ '</SendEmailOnAffiliateSignups>' ) }">

	<MvIF EXPR = "{ AffiliateManage.d.usefrom }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EmailFrom>' 	$ AffiliateManage.d.from 	$ '</EmailFrom>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EmailFrom>' 	$ 'Affiliate' 				$ '</EmailFrom>' ) }">	
	</MvIF>
	
	<MvIF EXPR = "{ AffiliateManage.d.useto }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EmailTo>' 		$ AffiliateManage.d.to 		$ '</EmailTo>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EmailTo>' 		$ 'Affiliate' 				$ '</EmailTo>' ) }">	
	</MvIF>

	<MvIF EXPR = "{ AffiliateManage.d.usecc }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EmailCC>' 		$ AffiliateManage.d.cc 		$ '</EmailCC>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EmailCC>' 		$ 'Affiliate' 				$ '</EmailCC>' ) }">	
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Subject>'			$ AffiliateManage.d.subject	$ '</Subject>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<HeaderText>'		$ AffiliateManage.d.header	$ '</HeaderText>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</AffiliateEmailNotification_Update>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Customers" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Feature_CUS_DB }" NAME = "l.email_loaded" VALUE = "{ CustomerEmail_Load() }">
	<MvIF EXPR = "{ NOT l.email_loaded }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<CustomerLostPasswordEmail_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EmailFrom>'	$ CustomerEmail.d.from 		$ '</EmailFrom>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EmailCC>' 		$ CustomerEmail.d.cc 		$ '</EmailCC>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Subject>'		$ CustomerEmail.d.subject	$ '</Subject>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<HeaderText>' 	$ CustomerEmail.d.header 	$ '</HeaderText>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</CustomerLostPasswordEmail_Update>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_Upsale" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Feature_USL_DB }" NAME = "l.options_found" VALUE = "{ UpsellOptions_Find() }">
	<MvIF EXPR = "{ NOT l.options_found }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<UpsellSettings_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ProductsToShow>' 		$ UpsellOptions.d.prod_shown $ '</ProductsToShow>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<MaxProductsToSelect>' 	$ UpsellOptions.d.prod_sell  $ '</MaxProductsToSelect>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</UpsellSettings_Update>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Groups" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "group_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "privileges">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "members">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "group_end">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Groups_Opened }">
		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "g.Upgrade5_Groups_Opened" VALUE = "{ _DB_Store_Open_Groups() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_Groups_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "Groups" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "Groups" ROWS = "{ l.step:offset }">
		</MvIF>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'groups', l.step:offset, Groups.d.totrec ) }">

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvSKIP NAME = "Groups" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ Groups.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'group_start' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Group_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'privileges' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Group_Privileges( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'members' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Group_Members( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'group_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Group_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Group_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Group_Add name="' 	$ Groups.d.name $ '">' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Group_Privileges" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_GroupPrivileges_Opened }">
		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "g.Upgrade5_GroupPrivileges_Opened" VALUE = "{ _DB_Store_Open_GroupPrivileges() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_GroupPrivileges_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_GroupPrivileges_Group NE Groups.d.id }">
		<MvFIND NAME = "GroupPrivileges" VALUE = "{ Groups.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_GroupPrivileges_Group"	VALUE = "{ Groups.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "GroupPrivileges" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "GroupPrivileges" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( GroupPrivileges.d.EOF ) OR ( GroupPrivileges.d.group_id NE Groups.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Privilege code="' $ GroupPrivileges.d.privilege $ '" view="' $ GroupPrivileges.d.view $ '" add="' $ GroupPrivileges.d.add $ '" modify="' $ GroupPrivileges.d.modify $ '" delete="' $ GroupPrivileges.d.delete $ '" />' ) }">

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Group_Members" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_UserXGroup_Opened }">
		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "g.Upgrade5_UserXGroup_Opened" VALUE = "{ _DB_Store_Open_UserXGroup() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_UserXGroup_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "UserXGroup" INDEX = "{ g._DB_Store_Directory $ 'uxg_grp.mvx' }">
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_UserXGroup_Group NE Groups.d.id }">
		<MvFIND NAME = "UserXGroup" VALUE = "{ Groups.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_UserXGroup_Group"	VALUE = "{ Groups.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "UserXGroup" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "UserXGroup" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( UserXGroup.d.EOF ) OR ( UserXGroup.d.group_id NE Groups.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.user_found" VALUE = "{ User_Find_ID( UserXGroup.d.user_id ) }">
	<MvIF EXPR = "{ l.user_Found }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Group_User_Assign group="' $ Groups.d.name $ '" user="' $ Users.d.name $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Group_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Group_Add>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Countries" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "country_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "country_list">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "country_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'country_start' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_CountryList_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'country_list' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_CountryList( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'country_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_CountryList_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>
	
<MvFUNCTION NAME = "Upgrade5_Step_CountryList_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Countries_Replace>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_CountryList" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:last"			VALUE = "">
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_StoreCountries_Opened }">
		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "g.Upgrade5_StoreCountries_Opened" VALUE = "{ _DB_Open_StoreCountries() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_StoreCountries_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "StoreCountries" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "StoreCountries" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "StoreCountries" ROWS = 1>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'countries', l.step:offset, StoreCountries.d.totrec ) }">

	<MvIF EXPR = "{ StoreCountries.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ StoreCountries.d.alpha NE l.step:last }">
		<MvASSIGN NAME = "l.step:last"			VALUE = "{ StoreCountries.d.alpha }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Country code="' $ StoreCountries.d.alpha $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_CountryList_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Countries_Replace>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_States" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "state_deleteall">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "state_list">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'state_deleteall' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_StateList_DeleteAll( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'state_list' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_StateList( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_StateList_DeleteAll" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<State_DeleteAll />' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_StateList" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_States_Opened }">
		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "g.Upgrade5_States_Opened" VALUE = "{ _DB_Store_Open_States() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_States_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "States" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "States" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "States" ROWS = 1>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'states', l.step:offset, States.d.totrec ) }">

	<MvIF EXPR = "{ States.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<State_Add code="' $ States.d.code $ '" name="' $ States.d.name $ '" />' ) }">

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Categories" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Categories_Opened }">
		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "g.Upgrade5_Categories_Opened" VALUE = "{ _DB_Store_Open_Categories() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_Categories_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "Categories" INDEX = "{ g._DB_Store_Directory $ 'cat_id.mvx' }">
		<MvGO NAME = "Categories" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "Categories" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "Categories" ROWS = 1>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'categories', l.step:offset, Categories.d.totrec ) }">

	<MvIF EXPR = "{ Categories.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Category_Add>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Code>'				$ Categories.d.code	$ '</Code>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Name><![CDATA['	$ Categories.d.name	$ ']]></Name>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Active>'	$ Upgrade5_Boolean( Categories.d.active )	$ '</Active>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Category_Add>' ) }">

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Category_Parents" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_CategoryParents_Opened }">
		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "g.Upgrade5_CategoryParents_Opened" VALUE = "{ _DB_Store_Open_Categories() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_CategoryParents_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "Categories" INDEX = "{ g._DB_Store_Directory $ 'cat_id.mvx' }">
		<MvGO NAME = "Categories" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "Categories" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "Categories" ROWS = 1>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'catparents', l.step:offset, Categories.d.totrec ) }">

	<MvIF EXPR = "{ Categories.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ Categories.d.parent_id }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Category_Update code="' $ Categories.d.code $ '">' ) }">

		<MvASSIGN NAME = "l.id" VALUE = "{ Categories.d.id }">

		<MvFIND NAME = "Categories" VALUE = "{ Categories.d.parent_id }" EXACT>
		<MvIF EXPR = "{ Categories.d.EOF }">
			<MvASSIGN NAME = "l.parent_code"	VALUE = "">
		<MvELSE>
			<MvASSIGN NAME = "l.parent_code"	VALUE = "{ Categories.d.code }">
		</MvIF>

		<MvFIND NAME = "Categories" VALUE = "{ l.id }" EXACT>

		<MvIF EXPR = "{ len( l.parent_code ) }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ParentCategoryCode>' $ l.parent_code $ '</ParentCategoryCode>' ) }">
		</MvIF>

		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Category_Update>' ) }">
	</MvIF>
	
	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Products" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "product">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "categories">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "attributes">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "inventory">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Products_Opened }">
		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "g.Upgrade5_Products_Opened" VALUE = "{ _DB_Store_Open_Products() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_Products_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "Products" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "Products" ROWS = "{ l.step:offset }">
		</MvIF>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'products', l.step:offset, Products.d.totrec ) }">

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvSKIP NAME = "Products" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ Products.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'product' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Product( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'categories' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Product_Categories( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'attributes' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Product_Attributes( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'inventory' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Product_Inventory( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Product" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Product_Add>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Code>'					$ Products.d.code							$ '</Code>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Name><![CDATA['		$ Products.d.name							$ ']]></Name>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Price>'				$ Products.d.price							$ '</Price>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Cost>'					$ Products.d.cost							$ '</Cost>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Weight>'				$ Products.d.weight							$ '</Weight>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Description><![CDATA['	$ Products.d.desc						 	$ ']]></Description>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Taxable>'				$ Upgrade5_Boolean( Products.d.taxable )	$ '</Taxable>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Active>'				$ Upgrade5_Boolean( Products.d.active )		$ '</Active>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ThumbnailImage>'		$ Products.d.thumbnail						$ '</ThumbnailImage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<FullSizeImage>'		$ Products.d.image							$ '</FullSizeImage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Product_Add>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Product_Categories" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_CategoryXProduct_Opened }">
		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "g.Upgrade5_CategoryXProduct_Opened" VALUE = "{ _DB_Store_Open_CategoryXProduct() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_CategoryXProduct_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "CategoryXProduct" INDEX = "{ g._DB_Store_Directory $ 'cxp_prod.mvx' }">
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_CategoryXProduct_Product NE Products.d.id }">
		<MvFIND NAME = "CategoryXProduct" VALUE = "{ Products.d.id }" EXACT>

		<MvASSIGN NAME = "g.Upgrade5_CategoryXProduct_Product"	VALUE = "{ Products.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "CategoryXProduct" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "CategoryXProduct" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( CategoryXProduct.d.EOF ) OR ( CategoryXProduct.d.product_id NE Products.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.found" VALUE = "{ Category_Find_ID( CategoryXProduct.d.cat_id ) }">
	<MvIF EXPR = "{ l.found }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<CategoryProduct_Assign category_code="' $ Categories.d.code $ '" product_code="' $ Products.d.code $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Product_Attributes" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "attribute">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "options">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Attributes_Opened }">
		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "g.Upgrade5_Attributes_Opened" VALUE = "{ _DB_Store_Open_Attributes() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_Attributes_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "Attributes" INDEX = "{ g._DB_Store_Directory $ 'atr_prod.mvx' }">
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_Attributes_Product NE Products.d.id }">
		<MvFIND NAME = "Attributes" VALUE = "{ Products.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_Attributes_Product"	VALUE = "{ Products.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "Attributes" ROWS = "{ l.step:offset }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvSKIP NAME = "Attributes" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ ( Attributes.d.EOF ) OR ( Attributes.d.product_id NE Products.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>

		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'attribute' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Product_Attribute( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'options' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Product_Attribute_Options( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Product_Attribute" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ Attributes.d.type EQ 'template' }">
		<MvDO FILE = "{ g.Module_Feature_ATT_DB }" NAME = "l.template_found" VALUE = "{ AttributeTemplate_Find_ID( Attributes.d.attemp_id ) }">
		<MvIF EXPR = "{ l.template_found }">
			<MvIF EXPR = "{ len( Attributes.d.code ) }">
				<MvASSIGN NAME = "l.attribute_code" VALUE = "{ Attributes.d.code }">
			<MvELSE>
				<MvASSIGN NAME = "l.attribute_code" VALUE = "{ AttributeTemplates.d.code }">
			</MvIF>
			
			<MvIF EXPR = "{ len( Attributes.d.prompt ) }">
				<MvASSIGN NAME = "l.attribute_prompt" VALUE = "{ Attributes.d.prompt }">
			<MvELSE>
				<MvASSIGN NAME = "l.attribute_prompt" VALUE = "{ AttributeTemplates.d.prompt }">
			</MvIF>

			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<ProductAttribute_Add_Template product_code="' 	$ Products.d.code		$ '">' ) }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Code>' 							$ l.attribute_code				$ '</Code>' ) }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Prompt><![CDATA[' 					$ l.attribute_prompt			$ ']]></Prompt>' ) }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<AttributeTemplateCode>' 			$ AttributeTemplates.d.code		$ '</AttributeTemplateCode>' ) }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</ProductAttribute_Add_Template>' ) }">
		</MvIF>
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<ProductAttribute_Add product_code="' 	$ Products.d.code							$ '">' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Code>' 							$ Attributes.d.code							$ '</Code>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Type>' 							$ Attributes.d.type							$ '</Type>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Prompt><![CDATA['					$ Attributes.d.prompt						$ ']]></Prompt>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Image>' 							$ Attributes.d.image						$ '</Image>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Price>' 							$ Attributes.d.price						$ '</Price>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Cost>' 							$ Attributes.d.cost							$ '</Cost>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Weight>' 							$ '0.00'									$ '</Weight>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Required>'							$ Upgrade5_Boolean( Attributes.d.required ) $ '</Required>' ) }">

		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</ProductAttribute_Add>' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Product_Attribute_Options" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Options_Opened }">
		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "g.Upgrade5_Options_Opened" VALUE = "{ _DB_Store_Open_Options() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_Options_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "Options" INDEX = "{ g._DB_Store_Directory $ 'opt_attr.mvx' }">
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_Options_Attributes NE Attributes.d.id }">
		<MvFIND NAME = "Options" VALUE = "{ Attributes.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_Options_Attribute"	VALUE = "{ Attributes.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "Options" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "Options" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( Options.d.EOF ) OR ( Options.d.attr_id NE Attributes.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<ProductAttributeOption_Add product_code="' 	$ Products.d.code 	$ '" attribute_code="' $ Attributes.d.code $ '">' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Code>' 									$ Options.d.code 	$ '</Code>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Prompt><![CDATA[' 							$ Options.d.prompt	$ ']]></Prompt>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Image>' 									$ Options.d.image 	$ '</Image>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Price>' 									$ Options.d.price 	$ '</Price>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Cost>' 									$ Options.d.cost 	$ '</Cost>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Weight>' 									$ '0.00'			$ '</Weight>' ) }">

	<MvIF EXPR = "{ Options.d.id EQ Attributes.d.default_id }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<DefaultOption>Yes</DefaultOption>' ) }">
	</MvIF>
	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</ProductAttributeOption_Add>' ) }">

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Product_Inventory" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Feature_INV_DB }" NAME = "l.inv_found" VALUE = "{ INV_InventoryProductSettings_Find_ProdID( Products.d.id ) }">
	<MvIF EXPR = "{ NOT l.inv_found }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvDO FILE = "{ g.Module_Feature_INV_DB }" NAME = "l.inventory_count" VALUE = "{ INV_InventoryProductCount( Products.d.id ) }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<InventoryProductSettings_Update product_code="' $ Products.d.code $ '">' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<TrackProduct>Yes</TrackProduct>' ) }">

	<MvIF EXPR = "{ l.inventory_count GT 0 }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<AdjustStockBy>'				$ l.inventory_count 										$ '</AdjustStockBy>' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<InStockMessageShort><![CDATA['		$ InventoryProductSettings.d.in_short						$ ']]></InStockMessageShort>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<InStockMessageLong><![CDATA['		$ InventoryProductSettings.d.in_long						$ ']]></InStockMessageLong>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<TrackLowStockLevel>'				$ Inventory_Code( InventoryProductSettings.d.low_track )	$ '</TrackLowStockLevel>' ) }">
	
	<MvIF EXPR = "{ InventoryProductSettings.d.low_lvl_d }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LowStockLevel>Default</LowStockLevel>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LowStockLevel>'				$ InventoryProductSettings.d.low_level 						$ '</LowStockLevel>' ) }">
	</MvIF>
	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LowStockMessageShort><![CDATA[' 	$ InventoryProductSettings.d.low_short						$ ']]></LowStockMessageShort>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LowStockMessageLong><![CDATA[' 	$ InventoryProductSettings.d.low_long						$ ']]></LowStockMessageLong>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<TrackOutOfStockLevel>'				$ Inventory_Code( InventoryProductSettings.d.out_track )	$ '</TrackOutOfStockLevel>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<HideOutOfStockProducts>'		 	$ Inventory_Code( InventoryProductSettings.d.out_hide )		$ '</HideOutOfStockProducts>' ) }">

	<MvIF EXPR = "{ InventoryProductSettings.d.out_lvl_d }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<OutOfStockLevel>Default</OutOfStockLevel>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<OutOfStockLevel>'				$ InventoryProductSettings.d.out_level 						$ '</OutOfStockLevel>' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<OutOfStockMessageShort><![CDATA[' 	$ InventoryProductSettings.d.out_short						$ ']]></OutOfStockMessageShort>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<OutOfStockMessageLong><![CDATA[' 	$ InventoryProductSettings.d.out_long						$ ']]></OutOfStockMessageLong>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LimitedStockMessage><![CDATA[' 	$ InventoryProductSettings.d.ltd_long						$ ']]></LimitedStockMessage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</InventoryProductSettings_Update>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Inventory_Code" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.code" VALUE = "{ tolower( l.code ) }">

	<MvIF EXPR = "{ l.code EQ 'y' }">			<MvFUNCTIONRETURN VALUE = "Yes">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'n' }">	<MvFUNCTIONRETURN VALUE = "No">
	<MvELSE>									<MvFUNCTIONRETURN VALUE = "Default">	
	</MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_RelatedProducts" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_RelatedProducts_Opened }">
		<MvDO FILE = "{ g.Module_Feature_RPD_DB }" NAME = "g.Upgrade5_RelatedProducts_Opened" VALUE = "{ _DB_Store_Open_RelatedProduct() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_RelatedProducts_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "RelatedProducts" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "RelatedProducts" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "RelatedProducts" ROWS = 1>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'relprod', l.step:offset, RelatedProducts.d.totrec ) }">

	<MvIF EXPR = "{ RelatedProducts.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.product_found" VALUE = "{ Product_Find_ID( RelatedProducts.d.product_id ) }">
	<MvIF EXPR = "{ l.product_found }">
		<MvASSIGN NAME = "l.product_code"	VALUE = "{ Products.d.code }">

		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.product_found" VALUE = "{ Product_Find_ID( RelatedProducts.d.relprod_id ) }">
		<MvIF EXPR = "{ l.product_found }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<ProductRelatedProduct_Assign product_code="' $ l.product_code $ '" relatedproduct_code="' $ Products.d.code $ '" />' ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_AttributeTemplates" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "template">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "attributes">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_AttributeTemplates_Opened }">
		<MvDO FILE = "{ g.Module_Feature_ATT_DB }" NAME = "g.Upgrade5_AttributeTemplates_Opened" VALUE = "{ _DB_Store_Open_AttributeTemplates() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_AttributeTemplates_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "AttributeTemplates" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "AttributeTemplates" ROWS = "{ l.step:offset }">
		</MvIF>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'atemplates', l.step:offset, AttributeTemplates.d.totrec ) }">

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvSKIP NAME = "AttributeTemplates" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ AttributeTemplates.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'template' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_AttributeTemplate( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'attributes' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_AttributeTemplate_Attributes( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_AttributeTemplate" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<AttributeTemplate_Add code="' $ AttributeTemplates.d.code $ '" prompt="' $ AttributeTemplates.d.prompt $ '" />' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_AttributeTemplate_Attributes" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "attribute">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "options">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_AttributeTemplateAttributes_Opened }">
		<MvDO FILE = "{ g.Module_Feature_ATT_DB }" NAME = "g.Upgrade5_AttributeTemplateAttributes_Opened" VALUE = "{ _DB_Store_Open_AttributeTemplateAttributes() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_AttributeTemplateAttributes_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "AttributeTemplateAttributes" INDEX = "{ g._DB_Store_Directory $ 'atmpatta.mvx' }">
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_AttributeTemplateAttributes_Template NE AttributeTemplates.d.id }">
		<MvFIND NAME = "AttributeTemplateAttributes" VALUE = "{ AttributeTemplates.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_AttributeTemplateAttributes_Template"	VALUE = "{ AttributeTemplates.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "AttributeTemplateAttributes" ROWS = "{ l.step:offset }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvSKIP NAME = "AttributeTemplateAttributes" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ ( AttributeTemplateAttributes.d.EOF ) OR ( AttributeTemplateAttributes.d.attemp_id NE AttributeTemplates.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>

		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'attribute' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_AttributeTemplate_Attribute( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'options' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_AttributeTemplate_Attribute_Options( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_AttributeTemplate_Attribute" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<AttributeTemplateAttribute_Add template_code="' 	$ AttributeTemplates.d.code 									$ '">' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Code>' 										$ AttributeTemplateAttributes.d.code 							$ '</Code>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Type>' 										$ AttributeTemplateAttributes.d.type 							$ '</Type>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Prompt><![CDATA[' 								$ AttributeTemplateAttributes.d.prompt							$ ']]></Prompt>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Image>' 										$ AttributeTemplateAttributes.d.image 							$ '</Image>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Price>' 										$ AttributeTemplateAttributes.d.price 							$ '</Price>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Cost>' 										$ AttributeTemplateAttributes.d.cost 							$ '</Cost>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Weight>' 										$ '0.00'														$ '</Weight>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Required>'										$ Upgrade5_Boolean( AttributeTemplateAttributes.d.required ) 	$ '</Required>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</AttributeTemplateAttribute_Add>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_AttributeTemplate_Attribute_Options" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_AttributeTemplateOptions_Opened }">
		<MvDO FILE = "{ g.Module_Feature_ATT_DB }" NAME = "g.Upgrade5_AttributeTemplateOptions_Opened" VALUE = "{ _DB_Store_Open_AttributeTemplateOptions() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_AttributeTemplateOptions_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "AttributeTemplateOptions" INDEX = "{ g._DB_Store_Directory $ 'attmpopa.mvx' }">
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_AttributeTemplateOptions_AttributeTemplateAttributes NE AttributeTemplateAttributes.d.id }">
		<MvFIND NAME = "AttributeTemplateOptions" VALUE = "{ AttributeTemplateAttributes.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_AttributeTemplateOptions_Attribute"	VALUE = "{ AttributeTemplateAttributes.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "AttributeTemplateOptions" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "AttributeTemplateOptions" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( AttributeTemplateOptions.d.EOF ) OR ( AttributeTemplateOptions.d.attmpat_id NE AttributeTemplateAttributes.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<AttributeTemplateAttributeOption_Add template_code="' 	$ AttributeTemplates.d.code 		$ '" attribute_code="' $ AttributeTemplateAttributes.d.code $ '">' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Code>' 											$ AttributeTemplateOptions.d.code 	$ '</Code>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Prompt><![CDATA['  								$ AttributeTemplateOptions.d.prompt	$ ']]></Prompt>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Image>' 											$ AttributeTemplateOptions.d.image 	$ '</Image>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Price>' 											$ AttributeTemplateOptions.d.price 	$ '</Price>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Cost>' 											$ AttributeTemplateOptions.d.cost 	$ '</Cost>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Weight>' 											$ '0.00'							$ '</Weight>' ) }">

	<MvIF EXPR = "{ AttributeTemplateOptions.d.id EQ AttributeTemplateAttributes.d.default_id }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<DefaultOption>Yes</DefaultOption>' ) }">
	</MvIF>
	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</AttributeTemplateAttributeOption_Add>' ) }">

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Upsale" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "product">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "reqprod">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Upsell_Opened }">
		<MvDO FILE = "{ g.Module_Feature_USL_DB }" NAME = "g.Upgrade5_Upsell_Opened" VALUE = "{ _DB_Store_Open_Upsell() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_Upsell_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "Upsell" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "Upsell" ROWS = "{ l.step:offset }">
		</MvIF>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'upsale', l.step:offset, Upsell.d.totrec ) }">

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvSKIP NAME = "Upsell" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ Upsell.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_Upsell_Product NE Upsell.d.product_id }">
		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.product_found" VALUE = "{ Product_Find_ID( Upsell.d.product_id ) }">
		<MvIF EXPR = "{ NOT l.product_found }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Upsell_Product"		VALUE = "{ Upsell.d.product_id }">
		<MvASSIGN NAME = "g.Upgrade5_Upsell_Product_Code"	VALUE = "{ Products.d.code }">
		<MvASSIGN NAME = "g.Upgrade5_Upsell_Product_Name"	VALUE = "{ Products.d.name }">
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'product' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_UpsProduct( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'reqprod' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_UpsRequiredProducts( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_UpsProduct" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<UpsoldProduct_Add>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ProductCode>' 		$ g.Upgrade5_Upsell_Product_Code	$ '</ProductCode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Display>' 			$ 'Total'							$ '</Display>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Required_Amount>'	$ Upsell.d.req_percnt				$ '</Required_Amount>' ) }">

	<MvIF EXPR = "{ Upsell.d.percent }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Pricing>PercentOfPrice</Pricing>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Pricing>AbsolutePrice</Pricing>' ) }">
	</MvIF>
	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Price>'			$ Upsell.d.price					$ '</Price>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</UpsoldProduct_Add>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_UpsRequiredProducts" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_UpsellXProduct_Opened }">
		<MvDO FILE = "{ g.Module_Feature_USL_DB }" NAME = "g.Upgrade5_UpsellXProduct_Opened" VALUE = "{ _DB_Store_Open_UpsellXProduct() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_UpsellXProduct_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "UpsellXProduct" INDEX = "{ g._DB_Store_Directory $ 'usp_prod.mvx' }">
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_UpsellXProduct_Product NE Upsell.d.product_id }">
		<MvFIND NAME = "UpsellXProduct" VALUE = "{ Upsell.d.product_id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_UpsellXProduct_Product"	VALUE = "{ Upsell.d.product_id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "UpsellXProduct" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "UpsellXProduct" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( UpsellXProduct.d.EOF ) OR ( UpsellXProduct.d.product_id NE Upsell.d.product_id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.product_found" VALUE = "{ Product_Find_ID( UpsellXProduct.d.req_prod ) }">
	<MvIF EXPR = "{ l.product_found }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<UpsoldProductRequiredProduct_Assign upsoldproduct_code="' $ g.Upgrade5_Upsell_Product_Code $ '" requiredproduct_code="' $ Products.d.code $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Affiliates" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Affiliates_Opened }">
		<MvDO FILE = "{ g.Module_Feature_AFF_DB }" NAME = "g.Upgrade5_Affiliates_Opened" VALUE = "{ _DB_Store_Open_Affiliates() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_Affiliates_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "Affiliates" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "Affiliates" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "Affiliates" ROWS = 1>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'affiliates', l.step:offset, Affiliates.d.totrec ) }">

	<MvIF EXPR = "{ Affiliates.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Affiliate_Add>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Login>'					$ Affiliates.d.code			$ '</Login>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LostPasswordEmail>'		$ Affiliates.d.lpasseml		$ '</LostPasswordEmail>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Password>'					$ Affiliates.d.password		$ '</Password>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ApplicationStatus>'		$ Affiliates.d.status		$ '</ApplicationStatus>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<SiteName>'					$ Affiliates.d.site_name	$ '</SiteName>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<SiteURL>'					$ Affiliates.d.site_url		$ '</SiteURL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ContactName>'				$ Affiliates.d.con_name		$ '</ContactName>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Company>'					$ Affiliates.d.company		$ '</Company>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Email>'					$ Affiliates.d.email		$ '</Email>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Phone>'					$ Affiliates.d.phone		$ '</Phone>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Fax>'						$ Affiliates.d.fax			$ '</Fax>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Address>'					$ Affiliates.d.addr			$ '</Address>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<City>'						$ Affiliates.d.city			$ '</City>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<State>'					$ Affiliates.d.state		$ '</State>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Zip>'						$ Affiliates.d.zip			$ '</Zip>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Country>'					$ Affiliates.d.country		$ '</Country>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<CommissionHit>' 			$ Affiliates.d.hits 		$ '</CommissionHit>' ) }"> 
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<CommissionPercentOfOrder>' $ Affiliates.d.percent 		$ '</CommissionPercentOfOrder>' ) }"> 
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<CommissionOrderFlatFee>' 	$ Affiliates.d.flat 		$ '</CommissionOrderFlatFee>' ) }"> 
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Affiliate_Add>' ) }">

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Customers" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Customers_Opened }">
		<MvDO FILE = "{ g.Module_Feature_CUS_DB }" NAME = "g.Upgrade5_Customers_Opened" VALUE = "{ _DB_Store_Open_Customers() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_Customers_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "Customers" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "Customers" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "Customers" ROWS = 1>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'customers', l.step:offset, Customers.d.totrec ) }">

	<MvIF EXPR = "{ Customers.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Customer_Add>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Login>' 				$ Customers.d.login 		$ '</Login>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LostPasswordEmail>' 	$ Customers.d.pw_email 		$ '</LostPasswordEmail>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Password>'		  		$ Customers.d.password	  	$ '</Password>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ShipFirstName>' 		$ Customers.d.ship_fname 	$ '</ShipFirstName>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ShipLastName>' 		$ Customers.d.ship_lname 	$ '</ShipLastName>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ShipEmail>' 			$ Customers.d.ship_email 	$ '</ShipEmail>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ShipPhone>' 			$ Customers.d.ship_phone 	$ '</ShipPhone>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ShipFax>' 				$ Customers.d.ship_fax 		$ '</ShipFax>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ShipCompany>' 			$ Customers.d.ship_comp 	$ '</ShipCompany>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ShipAddress>' 			$ Customers.d.ship_addr 	$ '</ShipAddress>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ShipCity>' 			$ Customers.d.ship_city 	$ '</ShipCity>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ShipStateCode>' 		$ Customers.d.ship_state 	$ '</ShipStateCode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ShipZip>' 				$ Customers.d.ship_zip 		$ '</ShipZip>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ShipCountryCode>' 		$ Customers.d.ship_cntry 	$ '</ShipCountryCode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BillFirstName>' 		$ Customers.d.bill_fname 	$ '</BillFirstName>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BillLastName>' 		$ Customers.d.bill_lname 	$ '</BillLastName>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BillEmail>' 			$ Customers.d.bill_email 	$ '</BillEmail>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BillPhone>' 			$ Customers.d.bill_phone 	$ '</BillPhone>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BillFax>' 				$ Customers.d.bill_fax 		$ '</BillFax>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BillCompany>' 			$ Customers.d.bill_comp 	$ '</BillCompany>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BillAddress>' 			$ Customers.d.bill_addr 	$ '</BillAddress>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BillCity>' 			$ Customers.d.bill_city 	$ '</BillCity>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BillStateCode>' 		$ Customers.d.bill_state 	$ '</BillStateCode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BillZip>' 				$ Customers.d.bill_zip 		$ '</BillZip>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BillCountryCode>' 		$ Customers.d.bill_cntry 	$ '</BillCountryCode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Customer_Add>' ) }">

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_AvailabilityGroups" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "group">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "customers">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "categories">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "products">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_AvailabilityGroups_Opened }">
		<MvDO FILE = "{ g.Module_Feature_AGR_DB }" NAME = "g.Upgrade5_AvailabilityGroups_Opened" VALUE = "{ _DB_Store_Open_AvailabilityGroups() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_AvailabilityGroups_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "AvailabilityGroups" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "AvailabilityGroups" ROWS = "{ l.step:offset }">
		</MvIF>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'availgroups', l.step:offset, AvailabilityGroups.d.totrec ) }">

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvSKIP NAME = "AvailabilityGroups" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ AvailabilityGroups.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'group' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_AvailabilityGroup( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'customers' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_AvailabilityGroup_Customers( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'categories' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_AvailabilityGroup_Categories( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'products' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_AvailabilityGroup_Products( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_AvailabilityGroup" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
    <MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<AvailabilityGroup_Add name="' $ AvailabilityGroups.d.name $ '" />' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_AvailabilityGroup_Customers" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_AvailabilityGroupXCustomer_Opened }">
		<MvDO FILE = "{ g.Module_Feature_AGR_DB }" NAME = "g.Upgrade5_AvailabilityGroupXCustomer_Opened" VALUE = "{ _DB_Store_Open_AvailabilityGroupXCustomer() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_AvailabilityGroupXCustomer_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "AvailabilityGroupXCustomer" INDEX = "{ g._DB_Store_Directory $ 'agxct_gp.mvx' }">
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_AvailabilityGroupXCustomer_Group NE AvailabilityGroups.d.id }">
		<MvFIND NAME = "AvailabilityGroupXCustomer" VALUE = "{ AvailabilityGroups.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_AvailabilityGroupXCustomer_Group"	VALUE = "{ AvailabilityGroups.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "AvailabilityGroupXCustomer" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "AvailabilityGroupXCustomer" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( AvailabilityGroupXCustomer.d.EOF ) OR ( AvailabilityGroupXCustomer.d.agrp_id NE AvailabilityGroups.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Feature_CUS_DB }" NAME = "l.found" VALUE = "{ Customer_Find_ID( AvailabilityGroupXCustomer.d.cust_id ) }">
	<MvIF EXPR = "{ l.found }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<AvailabilityGroupCustomer_Assign group_name="' $ AvailabilityGroups.d.name $ '" customer_login="' $ Customers.d.login $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_AvailabilityGroup_Categories" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_AvailabilityGroupXCategory_Opened }">
		<MvDO FILE = "{ g.Module_Feature_AGR_DB }" NAME = "g.Upgrade5_AvailabilityGroupXCategory_Opened" VALUE = "{ _DB_Store_Open_AvailabilityGroupXCategory() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_AvailabilityGroupXCategory_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "AvailabilityGroupXCategory" INDEX = "{ g._DB_Store_Directory $ 'agxc_gct.mvx' }">
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_AvailabilityGroupXCategory_Group NE AvailabilityGroups.d.id }">
		<MvFIND NAME = "AvailabilityGroupXCategory" VALUE = "{ AvailabilityGroups.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_AvailabilityGroupXCategory_Group"	VALUE = "{ AvailabilityGroups.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "AvailabilityGroupXCategory" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "AvailabilityGroupXCategory" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( AvailabilityGroupXCategory.d.EOF ) OR ( AvailabilityGroupXCategory.d.agrp_id NE AvailabilityGroups.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.found" VALUE = "{ Category_Find_ID( AvailabilityGroupXCategory.d.cat_id ) }">
	<MvIF EXPR = "{ l.found }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<AvailabilityGroupCategory_Assign group_name="' $ AvailabilityGroups.d.name $ '" category_code="' $ Categories.d.code $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_AvailabilityGroup_Products" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_AvailabilityGroupXProduct_Opened }">
		<MvDO FILE = "{ g.Module_Feature_AGR_DB }" NAME = "g.Upgrade5_AvailabilityGroupXProduct_Opened" VALUE = "{ _DB_Store_Open_AvailabilityGroupXProduct() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_AvailabilityGroupXProduct_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "AvailabilityGroupXProduct" INDEX = "{ g._DB_Store_Directory $ 'agxp_gpd.mvx' }">
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_AvailabilityGroupXProduct_Group NE AvailabilityGroups.d.id }">
		<MvFIND NAME = "AvailabilityGroupXProduct" VALUE = "{ AvailabilityGroups.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_AvailabilityGroupXProduct_Group"	VALUE = "{ AvailabilityGroups.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "AvailabilityGroupXProduct" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "AvailabilityGroupXProduct" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( AvailabilityGroupXProduct.d.EOF ) OR ( AvailabilityGroupXProduct.d.agrp_id NE AvailabilityGroups.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.found" VALUE = "{ Product_Find_ID( AvailabilityGroupXProduct.d.product_id ) }">
	<MvIF EXPR = "{ l.found }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<AvailabilityGroupProduct_Assign group_name="' $ AvailabilityGroups.d.name $ '" product_code="' $ Products.d.code $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_PriceGroups" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "group">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "customers">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "products">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_PriceGroups_Opened }">
		<MvDO FILE = "{ g.Module_Feature_PGR_DB }" NAME = "g.Upgrade5_PriceGroups_Opened" VALUE = "{ _DB_Store_Open_PriceGroups() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_PriceGroups_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "PriceGroups" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "PriceGroups" ROWS = "{ l.step:offset }">
		</MvIF>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'pricegroups', l.step:offset, PriceGroups.d.totrec ) }">

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvSKIP NAME = "PriceGroups" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroups.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'group' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_PriceGroup( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'customers' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_PriceGroup_Customers( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'products' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_PriceGroup_Products( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_PriceGroup" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricing" VALUE = "{ PriceGroup_Rate( PriceGroups.d.rate ) }">
	<MvIF EXPR = "{ l.pricing EQ 'Discount' }">
		<MvASSIGN NAME = "l.amount" VALUE = "{ PriceGroups.d.discount }">	
	<MvELSE> <MvIF EXPR = "{ l.pricing EQ 'Markup' }">
		<MvASSIGN NAME = "l.amount" VALUE = "{ PriceGroups.d.markup }">
	<MvELSE>
		<MvASSIGN NAME = "l.amount" VALUE = "0.00">
	</MvIF> </MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<PriceGroup_Add>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Name>' 	$ PriceGroups.d.name 	$ '</Name>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Pricing>' 	$ l.pricing 			$ '</Pricing>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Amount>' 	$ l.amount 				$ '</Amount>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</PriceGroup_Add>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Rate" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'R' }">			<MvFUNCTIONRETURN VALUE = "Retail">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'C' }">	<MvFUNCTIONRETURN VALUE = "Cost">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'D' }">	<MvFUNCTIONRETURN VALUE = "Discount">
	<MvELSE>									<MvFUNCTIONRETURN VALUE = "Markup">	
	</MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_PriceGroup_Customers" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_PriceGroupXCustomer_Opened }">
		<MvDO FILE = "{ g.Module_Feature_PGR_DB }" NAME = "g.Upgrade5_PriceGroupXCustomer_Opened" VALUE = "{ _DB_Store_Open_PriceGroupXCustomer() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_PriceGroupXCustomer_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "PriceGroupXCustomer" INDEX = "{ g._DB_Store_Directory $ 'pgxc_grp.mvx' }">
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_PriceGroupXCustomer_Group NE PriceGroups.d.id }">
		<MvFIND NAME = "PriceGroupXCustomer" VALUE = "{ PriceGroups.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_PriceGroupXCustomer_Group"	VALUE = "{ PriceGroups.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "PriceGroupXCustomer" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "PriceGroupXCustomer" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( PriceGroupXCustomer.d.EOF ) OR ( PriceGroupXCustomer.d.pgrp_id NE PriceGroups.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Feature_CUS_DB }" NAME = "l.found" VALUE = "{ Customer_Find_ID( PriceGroupXCustomer.d.cust_id ) }">
	<MvIF EXPR = "{ l.found }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<PriceGroupCustomer_Assign group_name="' $ PriceGroups.d.name $ '" customer_login="' $ Customers.d.login $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_PriceGroup_Products" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_PriceGroupXProduct_Opened }">
		<MvDO FILE = "{ g.Module_Feature_PGR_DB }" NAME = "g.Upgrade5_PriceGroupXProduct_Opened" VALUE = "{ _DB_Store_Open_PriceGroupXProduct() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_PriceGroupXProduct_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvPRIMARY NAME = "PriceGroupXProduct" INDEX = "{ g._DB_Store_Directory $ 'pgxp_grp.mvx' }">
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_PriceGroupXProduct_Group NE PriceGroups.d.id }">
		<MvFIND NAME = "PriceGroupXProduct" VALUE = "{ PriceGroups.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_PriceGroupXProduct_Group"	VALUE = "{ PriceGroups.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "PriceGroupXProduct" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "PriceGroupXProduct" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( PriceGroupXProduct.d.EOF ) OR ( PriceGroupXProduct.d.pgrp_id NE PriceGroups.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.found" VALUE = "{ Product_Find_ID( PriceGroupXProduct.d.product_id ) }">
	<MvIF EXPR = "{ l.found }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<PriceGroupProduct_Assign group_name="' $ PriceGroups.d.name $ '" product_code="' $ Products.d.code $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Modules" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "module_start">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "module">				<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "module_end">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_StoreModules_Opened }">
		<MvDO FILE = "{ g.Module_Library_DB }" NAME = "g.Upgrade5_StoreModules_Opened" VALUE = "{ _DB_Store_Open_StoreModules() AND
																								  _DB_Open_Modules() }">
		<MvIF EXPR = "{ NOT g.Upgrade5_StoreModules_Opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "StoreModules" ROW = "top">
		<MvPRIMARY NAME = "Modules" INDEX = "{ g.MerchantPath $ 'mod_id.mvx' }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "StoreModules" ROWS = "{ l.step:offset }">
		</MvIF>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Status( 'modules', l.step:offset, StoreModules.d.totrec ) }">

	<MvIF EXPR = "{ ( ( StoreModules.d.type EQ 'UI' ) AND ( l.step:substep_pos GT 1 ) ) OR
					( l.step:substep_pos GT l.step:substep_count ) }">
		<MvSKIP NAME = "StoreModules" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ StoreModules.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_StoreModules_Module NE StoreModules.d.module_id }">
		<MvFIND NAME = "Modules" VALUE = "{ StoreModules.d.module_id }" EXACT>
		<MvIF EXPR = "{ Modules.d.EOF OR ( Modules.d.active EQ 0 ) }">
			<MvASSIGN NAME = "l.step:substep_pos"	VALUE = "{ l.step:substep_count + 1 }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_StoreModules_Module"	VALUE = "{ StoreModules.d.module_id }">
	</MvIF>

	<MvIF EXPR = "{ StoreModules.d.type EQ 'UI' }">
		<MvIF EXPR = "{ Modules.d.code EQ 'mmui' }">											<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI( l.step:mmui ) }">
		<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = 1> <MvCOMMENT> Skip </MvCOMMENT>
		</MvIF>
	<MvELSE>
		<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'module_start' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_Start( l.step:substeps[ l.step:substep_pos ] ) }">
		<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'module' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module( l.step:substeps[ l.step:substep_pos ] ) }">
		<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'module_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_End( l.step:substeps[ l.step:substep_pos ] ) }">
		<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
		</MvIF> </MvIF> </MvIF>
	</MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.code"		VALUE = "{ Modules.d.code }">
	<MvASSIGN NAME = "l.feature"	VALUE = "{ tolower( StoreModules.d.type ) }">

	<MvIF EXPR = "{ l.code EQ 'Paradata' }">			<MvASSIGN NAME = "l.code"		VALUE = "paradata">
	</MvIF>

	<MvIF EXPR = "{ l.feature EQ 'fulfillment' }">		<MvASSIGN NAME = "l.feature"	VALUE = "fulfill">
	<MvELSEIF EXPR = "{ l.feature EQ 'storeutil' }">	<MvASSIGN NAME = "l.feature"	VALUE = "util">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="' $ l.code $ '" feature="' $ l.feature $ '">' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_EnabledMethods_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Enabled_Methods>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_EnabledMethods_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Enabled_Methods>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ Modules.d.code EQ 'eurocur' }">					<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_EuroCurrency( l.step:eurocur ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'gencurr' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_GenericCurrency( l.step:gencurr ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'custeml' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_CustomerEmail( l.step:custeml ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'meremail' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_MerchantEmail( l.step:meremail ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'elf' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_ELF( l.step:elf ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'malf' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_MALF( l.step:malf ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'amerinet' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_AmeriNet( l.step:amerinet ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'authnet' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_AuthorizeNet( l.step:authnet ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'cod' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_COD( l.step:cod ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'e-SELECT' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_eSELECT( l.step:eselect ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'evalcheck' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_eValuCheck( l.step:evalcheck ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'globcomm' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_GlobalComm( l.step:globcomm ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'ics2' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_ICS2( l.step:ics2 ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'igsgroup' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_IgsGroup( l.step:igsgroup ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'linkpt' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_LinkPoint( l.step:linkpt ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'lynksys' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_LynkSystems( l.step:lynksys ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'mod10' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_MOD10( l.step:mod10 ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'mvpay' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_MvPay( l.step:mvpay ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'Paradata' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_Paradata( l.step:paradata ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'paylink' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_PayLink( l.step:paylink ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'paynet' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_PaymentNet( l.step:paynet ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'paypal' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_PayPal( l.step:paypal ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'payquake' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_PayQuake( l.step:payquake ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'quickcom' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_QuickCommerce( l.step:quickcom ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'rodopi' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_Rodopi( l.step:rodopi ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'usms' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_USMS( l.step:usms ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'baseunit' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_BaseUnit( l.step:baseunit ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'flatrate' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_FlatRate( l.step:flatrate ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'minunit' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_MinUnit( l.step:minunit ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'mvfedex' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_MvFedEx( l.step:mvfedex ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'mvusps' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_MvUSPS( l.step:mvusps ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'ups' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_UPS( l.step:ups ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'ptbship' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_PTBS( l.step:ptbship ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'qship' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_QuantShip( l.step:qship ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'wtbship' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_WTBS( l.step:wtbship ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'canvat' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_CanVat( l.step:canvat ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'certitax' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_CertiTAX( l.step:canvat ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'devat' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_DEVAT( l.step:devat ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'shoptax' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_ShopTax( l.step:shoptax ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'statetax' }">		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_StateTax( l.step:statetax ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'vat' }">			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_VAT( l.step:vat ) }">
	<MvELSE> <MvIF EXPR = "{ Modules.d.code EQ 'customfields' }">	<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_CustomFields( l.step:customfields ) }">
	<MvELSE>														<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Step_Module_Unknown( l.step:unknown[ Modules.d.id ] ) }">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MMUI_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ MMUI_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MMUI_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" 	  MEMBER = "code" VALUE = "store">					<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" 	  MEMBER = "code" VALUE = "buttons_start">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" 	  MEMBER = "code" VALUE = "buttons">				<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" 	  MEMBER = "code" VALUE = "buttons_end">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvIF EXPR = "{ MMUI_Categories.d.totrec }">
			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "category_hdft">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "category_titles_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "category_titles">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "category_titles_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "category_timages_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "category_timages">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "category_timages_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		</MvIF>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" 	  MEMBER = "code" VALUE = "prodlayout">				<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvIF EXPR = "{ MMUI_Products.d.totrec }">
			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "product_hdft">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		</MvIF>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'store' }">							<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI_Store( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'buttons_start' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI_Buttons_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'buttons' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI_Buttons( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'buttons_end' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI_Buttons_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'category_hdft' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI_Category_HeaderFooter( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'category_titles_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI_Category_Titles_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'category_titles' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI_Category_Titles( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'category_titles_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI_Category_Titles_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'category_timages_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI_Category_TreeImages_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'category_timages' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI_Category_TreeImages( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'category_timages_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI_Category_TreeImages_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'prodlayout' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI_ProductLayout( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'product_hdft' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MMUI_Product_HeaderFooter( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																							<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>	</MvIF>	</MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI_Store" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| BODY Tag Settings
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="cmp-mmui-body" feature="component">' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BackgroundColor>'			$ MMUI_Store.d.body_bg		$ '</BackgroundColor>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LinkColor>'				$ MMUI_Store.d.body_link	$ '</LinkColor>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ActiveLinkColor>'			$ MMUI_Store.d.body_alink	$ '</ActiveLinkColor>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ViewedLinkColor>'			$ MMUI_Store.d.body_vlink	$ '</ViewedLinkColor>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BackgroundImage>'			$ MMUI_Store.d.body_img		$ '</BackgroundImage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">

	<MvCOMMENT>
	|
	| Misc. Colors
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="cmp-mmui-colors" feature="component">' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<CategoryBackgroundColor>'		$ MMUI_Store.d.ctgy_bg		$ '</CategoryBackgroundColor>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ListHeaderBackgroundColor>'	$ MMUI_Store.d.lhdr_bg		$ '</ListHeaderBackgroundColor>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ListAlternateColor>'			$ MMUI_Store.d.list_alt		$ '</ListAlternateColor>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">

	<MvCOMMENT>
	|
	| Affiliate Link
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.login_source"		VALUE = "{ '<a href="&mvt:global:secure_sessionurl;Screen=AFCL&Order=0&Store_Code=&mvt:global:Store_Code;">' $ MMUI_Store.d.ltext $ '</a>' $ asciichar( 10 ) $
													   '<br><br>' }">

	<MvASSIGN NAME = "l.edit_source"		VALUE = "{ '<a href="&mvt:global:secure_sessionurl;Screen=AFAE&Order=0&Store_Code=&mvt:global:Store_Code;">' }">
	<MvASSIGN NAME = "l.affil_text"			VALUE = "{ glosub( MMUI_Store.d.etext,	'%affiliate_login%',		'&mvt:global:Affiliate:code;' ) }">
	<MvASSIGN NAME = "l.affil_text"			VALUE = "{ glosub( l.affil_text,		'%affiliate_site_name%',	'&mvt:global:Affiliate:site_name;' ) }">
	<MvASSIGN NAME = "l.edit_source"		VALUE = "{ l.edit_source $ l.affil_text $ '</a>' $ asciichar( 10 ) $ '<br><br>' }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="cmp-mmui-afflink" feature="component">' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Login_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Template><![CDATA['	$ l.login_source	$ ']]></Template>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Login_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Edit_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Template><![CDATA['	$ l.edit_source		$ ']]></Template>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Edit_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">

	<MvCOMMENT>
	|
	| Customer Link
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.login_source"		VALUE = "{ '<a href="&mvt:global:secure_sessionurl;Screen=LOGN&Order=0&Store_Code=&mvt:global:Store_Code;">' $ MMUI_Store.d.ctgy_logn $ '</a>' $ asciichar( 10 ) $
													   '<br><br>' }">

	<MvASSIGN NAME = "l.edit_source"		VALUE = "{ '<a href="&mvt:global:secure_sessionurl;Screen=ACNT&Order=0&Store_Code=&mvt:global:Store_Code;">' $ MMUI_Store.d.ctgy_bcust }">
	
	<MvIF EXPR = "{ MMUI_Store.d.ctgy_cust EQ 'FIRST' }">
		<MvASSIGN NAME = "l.edit_source"	VALUE = "{ l.edit_source $ '&mvt:global:Customer:bill_fname;' }">
	<MvELSE> <MvIF EXPR = "{ MMUI_Store.d.ctgy_cust EQ 'FIRSTLAST' }">
		<MvASSIGN NAME = "l.edit_source"	VALUE = "{ l.edit_source $ '&mvt:global:Customer:bill_fname; &mvt:global:Customer:bill_lname;' }">
	</MvIF> </MvIF>
	
	<MvASSIGN NAME = "l.edit_source"		VALUE = "{ l.edit_source $ MMUI_Store.d.ctgy_acust $ '</a>' $ asciichar( 10 ) $ '<br><br>' }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="cmp-mmui-custlink" feature="component">' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Login_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Template><![CDATA['	$ l.login_source	$ ']]></Template>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Login_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Edit_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Template><![CDATA['	$ l.edit_source		$ ']]></Template>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Edit_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">

	<MvCOMMENT>
	|
	| Fonts
	|
	</MvCOMMENT>
		
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="cmp-mmui-fonts" feature="component">' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Body>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Face>'		$ MMUI_Store.d.body_font	$ '</Face>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Size>'		$ MMUI_Store.d.body_fsize	$ '</Size>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Color>'	$ MMUI_Store.d.body_text	$ '</Color>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Body>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Category>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Face>'		$ MMUI_Store.d.ctgy_font	$ '</Face>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Size>'		$ MMUI_Store.d.ctgy_fsize	$ '</Size>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Category>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Header>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Face>'		$ MMUI_Store.d.hdr_font				$ '</Face>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Size>'		$ MMUI_Store.d.hdr_fsize			$ '</Size>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Color>'	$ MMUI_Store.d.hdr_fg				$ '</Color>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Header>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ListHeader>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Face>'		$ MMUI_Store.d.lhdr_font			$ '</Face>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Size>'		$ MMUI_Store.d.lhdr_fsize			$ '</Size>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Color>'	$ MMUI_Store.d.lhdr_fg				$ '</Color>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</ListHeader>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">

	<MvCOMMENT>
	|
	| Navigation Bar
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="cmp-mmui-navbar" feature="component">' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BackgroundColor>'	$ MMUI_Store.d.nav_bg		$ '</BackgroundColor>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Logo>'				$ MMUI_Store.d.nav_logo		$ '</Logo>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LogoLink>'			$ MMUI_Store.d.nav_link		$ '</LogoLink>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<SelectStore>'		$ MMUI_Store.d.nav_selstr	$ '</SelectStore>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<StoreFront>'		$ MMUI_Store.d.nav_store	$ '</StoreFront>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Account>'			$ MMUI_Store.d.nav_accnt	$ '</Account>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Search>'			$ MMUI_Store.d.nav_search	$ '</Search>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ProductList>'		$ MMUI_Store.d.nav_plst		$ '</ProductList>' ) }"> 
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<BasketContents>'	$ MMUI_Store.d.nav_basket	$ '</BasketContents>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Checkout>'			$ MMUI_Store.d.nav_check	$ '</Checkout>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">

	<MvCOMMENT>
	|
	| Messages
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="cmp-mmui-messages" feature="component">' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Welcome_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Template><![CDATA['					$ MMUI_Store.d.welcome	$ ']]></Template>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Notes>Upgrade from Miva Merchant v'	$ g.Merchant_Version	$ '</Notes>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Welcome_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ThankYou_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Template><![CDATA['					$ MMUI_Store.d.thankyou	$ ']]></Template>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Notes>Upgrade from Miva Merchant v'	$ g.Merchant_Version	$ '</Notes>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</ThankYou_Update>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">

	<MvCOMMENT>
	|
	| Page Headers and Footers
	|
	</MvCOMMENT>
	
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'LOGN', MMUI_Store.d.logn_head,	MMUI_Store.d.logn_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'SRCH', MMUI_Store.d.srch_head,	MMUI_Store.d.srch_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'PLST', MMUI_Store.d.plst_head,	MMUI_Store.d.plst_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'BASK', MMUI_Store.d.bask_head,	MMUI_Store.d.bask_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'OCST', MMUI_Store.d.oinf_head,	MMUI_Store.d.oinf_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'OUSL', MMUI_Store.d.ousl_head,	MMUI_Store.d.ousl_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'OUSM', MMUI_Store.d.ousl_head,	MMUI_Store.d.ousl_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'UATR', MMUI_Store.d.uatr_head,	MMUI_Store.d.uatr_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'UATM', MMUI_Store.d.uatr_head,	MMUI_Store.d.uatr_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'OSEL', MMUI_Store.d.osel_head,	MMUI_Store.d.osel_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'OPAY', MMUI_Store.d.opay_head,	MMUI_Store.d.opay_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'INVC', MMUI_Store.d.invc_head,	MMUI_Store.d.invc_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'PATR', MMUI_Store.d.attr_head,	MMUI_Store.d.attr_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'ACED', MMUI_Store.d.eact_head,	MMUI_Store.d.eact_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'ACAD', MMUI_Store.d.cact_head,	MMUI_Store.d.cact_foot ) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'AFCL', MMUI_Store.d.lheader,	MMUI_Store.d.lfooter) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'AFAD', MMUI_Store.d.aheader,	MMUI_Store.d.afooter) }">
	<MvEVAL EXPR = "{ Upgrade5_MMUI_Page_HeaderFooter( 'AFED', MMUI_Store.d.eheader,	MMUI_Store.d.efooter) }">

	<MvCOMMENT>
	|
	| Global Header & Footer
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.header_len"	VALUE = "{ len( MMUI_Store.d.glob_head ) }">
	<MvASSIGN NAME = "l.footer_len"	VALUE = "{ len( MMUI_Store.d.glob_foot ) }">

	<MvIF EXPR = "{ l.header_len OR l.footer_len }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="cmp-mv-hdft" feature="component">' ) }">

		<MvIF EXPR = "{ l.header_len }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Header_Update>' ) }">	
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Template><![CDATA['					$ MMUI_Store.d.glob_head	$ ']]></Template>' ) }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Notes>Upgrade from Miva Merchant v'	$ g.Merchant_Version		$ '</Notes>' ) }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Header_Update>' ) }">	
		</MvIF>

		<MvIF EXPR = "{ l.footer_len }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Footer_Update>' ) }">	
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Template><![CDATA['					$ MMUI_Store.d.glob_foot	$ ']]></Template>' ) }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Notes>Upgrade from Miva Merchant v'	$ g.Merchant_Version		$ '</Notes>' ) }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Footer_Update>' ) }">	
		</MvIF>

		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">	
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_MMUI_Page_HeaderFooter" PARAMETERS = "page, header, footer" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.header_len"	VALUE = "{ len( l.header ) }">
	<MvASSIGN NAME = "l.footer_len"	VALUE = "{ len( l.footer ) }">

	<MvIF EXPR = "{ ( l.header_len EQ 0 ) AND ( l.footer_len EQ 0 ) }">
		<MvFUNCTIONRETURN>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Page_Update code="' $ l.page $ '">' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Item code="hdft">' ) }">	

	<MvIF EXPR = "{ l.header_len }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Header_Update>' ) }">	
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Template><![CDATA['					$ l.header				$ ']]></Template>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Notes>Upgrade from Miva Merchant v'	$ g.Merchant_Version	$ '</Notes>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				</Header_Update>' ) }">	
	</MvIF>

	<MvIF EXPR = "{ l.footer_len }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Footer_Update>' ) }">	
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Template><![CDATA['					$ l.footer				$ ']]></Template>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Notes>Upgrade from Miva Merchant v'	$ g.Merchant_Version	$ '</Notes>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				</Footer_Update>' ) }">	
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Item>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Page_Update>' ) }">	
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI_Buttons_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="cmp-mmui-buttons" feature="component">' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI_Buttons" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MMUI_Buttons_Open }">
		<MvGO NAME = "MMUI_Buttons" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "MMUI_Buttons" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MMUI_Buttons_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "MMUI_Buttons" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ MMUI_Buttons.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Button_Update code="' $ MMUI_Buttons.d.code $ '">' ) }">	

	<MvIF EXPR = "{ MMUI_Buttons.d.mode EQ 'D' }">
		<MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'Add1ToBasket' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text>Add One To Basket</Text>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'Add1ToBasketL' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Image>graphics/en-US/mmui/addone.gif</Image>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'Add1ToOrder' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text>Add One To Order</Text>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'AddToBasket' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text>Add To Basket</Text>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'Buy1Now' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text>Buy One Now</Text>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'Buy1NowL' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Image>graphics/en-US/mmui/buyone.gif</Image>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'Continue' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text>Continue</Text>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'DoNotAddToOrder' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text>Do Not Add To Order</Text>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'Login' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text>Login</Text>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'Next' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text><![CDATA[Next >]]></Text>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'Previous' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text><![CDATA[< Previous]]></Text>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'Remove' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text>Remove</Text>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'Save' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text>Save</Text>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'Search' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text>Search</Text>' ) }">
		<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.code EQ 'Update' }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text>Update</Text>' ) }">
		</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
	<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.mode EQ 'T' }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Text><![CDATA['	$ MMUI_Buttons.d.text		$ ']]></Text>' ) }">			
	<MvELSE> <MvIF EXPR = "{ MMUI_Buttons.d.mode EQ 'I' }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Image>'			$ MMUI_Buttons.d.image		$ '</Image>' ) }">			
	</MvIF> </MvIF> </MvIF>
	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Button_Update>' ) }">		

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI_Buttons_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI_Category_HeaderFooter" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MMUI_CategoryHeaderFooter_Open }">
		<MvGO NAME = "MMUI_Categories" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "MMUI_Categories" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MMUI_CategoryHeaderFooter_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "MMUI_Categories" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ MMUI_Categories.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.category_found" VALUE = "{ Category_Find_ID( MMUI_Categories.d.cat_id ) }">
	<MvIF EXPR = "{ l.category_found }">
		<MvIF EXPR = "{ len( MMUI_Categories.d.header ) OR len( MMUI_Categories.d.footer ) }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="cmp-mmui-pchdft" feature="component">' ) }">

			<MvIF EXPR = "{ len( MMUI_Categories.d.header ) }">
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Category_Header category_code="' $ Categories.d.code $ '">' ) }">	
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Template><![CDATA['					$ MMUI_Categories.d.header	$ ']]></Template>' ) }">
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Notes>Upgrade from Miva Merchant v'	$ g.Merchant_Version		$ '</Notes>' ) }">
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Category_Header>' ) }">
			</MvIF>

			<MvIF EXPR = "{ len( MMUI_Categories.d.footer ) }">
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Category_Footer category_code="' $ Categories.d.code $ '">' ) }">	
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Template><![CDATA['					$ MMUI_Categories.d.footer	$ ']]></Template>' ) }">
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Notes>Upgrade from Miva Merchant v'	$ g.Merchant_Version		$ '</Notes>' ) }">
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Category_Footer>' ) }">
			</MvIF>

			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI_Category_Titles_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="cmp-mmui-cattitle" feature="component">' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI_Category_Titles" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MMUI_CategoryTitleImages_Open }">
		<MvGO NAME = "MMUI_Categories" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "MMUI_Categories" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MMUI_CategoryTitleImages_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "MMUI_Categories" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ MMUI_Categories.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.category_found" VALUE = "{ Category_Find_ID( MMUI_Categories.d.cat_id ) }">
	<MvIF EXPR = "{ l.category_found }">
		<MvIF EXPR = "{ len( MMUI_Categories.d.title_img ) }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Image category_code="' $ Categories.d.code $ '">' $ MMUI_Categories.d.title_img $ '</Image>' ) }">	
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI_Category_Titles_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI_Category_TreeImages_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="cmp-mmui-cattree" feature="component">' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI_Category_TreeImages" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MMUI_CategoryTreeImages_Open }">
		<MvGO NAME = "MMUI_Categories" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "MMUI_Categories" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MMUI_CategoryTreeImages_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "MMUI_Categories" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ MMUI_Categories.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.category_found" VALUE = "{ Category_Find_ID( MMUI_Categories.d.cat_id ) }">
	<MvIF EXPR = "{ l.category_found }">
		<MvIF EXPR = "{ len( MMUI_Categories.d.tree_img ) }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Image category_code="' $ Categories.d.code $ '">' $ MMUI_Categories.d.tree_img $ '</Image>' ) }">	
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI_Category_TreeImages_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI_ProductLayout" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MMUI_ProductLayout_Open }">
		<MvGO NAME = "MMUI_ProductLayout" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "MMUI_ProductLayout" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MMUI_ProductLayout_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "MMUI_ProductLayout" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ MMUI_ProductLayout.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ MMUI_ProductLayout.d.screen EQ 'PROD' }">
		<MvASSIGN NAME = "l.page_code"	VALUE = "PLST">
		<MvASSIGN NAME = "l.item_code"	VALUE = "product_list">
	<MvELSE> <MvIF EXPR = "{ MMUI_ProductLayout.d.screen EQ 'SRCH' }">
		<MvASSIGN NAME = "l.page_code"	VALUE = "SRCH">
		<MvASSIGN NAME = "l.item_code"	VALUE = "product_list">
	<MvELSE> <MvIF EXPR = "{ MMUI_ProductLayout.d.screen EQ 'RELP' }">
		<MvASSIGN NAME = "l.page_code"	VALUE = "PROD">
		<MvASSIGN NAME = "l.item_code"	VALUE = "product_list">
	<MvELSE> <MvIF EXPR = "{ MMUI_ProductLayout.d.screen EQ 'PRDS' }">
		<MvASSIGN NAME = "l.page_code"	VALUE = "PROD">
		<MvASSIGN NAME = "l.item_code"	VALUE = "product_display">
	<MvELSE>
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Page_Update code="' $ l.page_code $ '">' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Item code="' $ l.item_code $ '">' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Notes>Upgrade from Miva Merchant v'	$ g.Merchant_Version											$ '</Notes>' ) }">

	<MvIF EXPR = "{ MMUI_ProductLayout.d.screen NE 'PRDS' }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Format>'							$ MMUI_ProductLayout_Format( MMUI_ProductLayout.d.format )		$ '</Format>' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Image>'								$ MMUI_ProductLayout_Image( MMUI_ProductLayout.d.image )		$ '</Image>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<InventoryMessage>'						$ MMUI_ProductLayout_Inventory( MMUI_ProductLayout.d.invlevel )	$ '</InventoryMessage>' ) }">

	<MvIF EXPR = "{ MMUI_ProductLayout.d.screen EQ 'PROD' }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<ProductsPerPage>'					$ MMUI_Store.d.plst_len											$ '</ProductsPerPage>' ) }">
	<MvELSE> <MvIF EXPR = "{ MMUI_ProductLayout.d.screen EQ 'SRCH' }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<ProductsPerPage>'					$ MMUI_Store.d.srch_len											$ '</ProductsPerPage>' ) }">
	</MvIF> </MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Fields>' ) }">	
	<MvIF EXPR = "{ MMUI_ProductLayout.d.prodname }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Name />' ) }">				
	</MvIF>

	<MvIF EXPR = "{ MMUI_ProductLayout.d.prodcode }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Code />' ) }">				
	</MvIF>

	<MvIF EXPR = "{ MMUI_ProductLayout.d.prodprice }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Price />' ) }">				
	</MvIF>

	<MvIF EXPR = "{ MMUI_ProductLayout.d.prodweight }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Weight />' ) }">				
	</MvIF>

	<MvIF EXPR = "{ MMUI_ProductLayout.d.proddesc }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Description />' ) }">				
	</MvIF>

	<MvCOMMENT>
	|
	| Custom Fields
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ Modules.d.version GE 4.24 }">
		<MvASSIGN NAME = "l.recno"	VALUE = "{ Modules.d.recno }">

		<MvFIND NAME = "MMUI_CustomProductLayout" VALUE = "{ MMUI_ProductLayout.d.screen $ ':' }">
		<MvWHILE EXPR = "{ ( NOT MMUI_CustomProductLayout.d.EOF ) AND ( MMUI_CustomProductLayout.d.screen EQ MMUI_ProductLayout.d.screen ) }">
			<MvFIND NAME = "Modules" VALUE = "{ MMUI_CustomProductLayout.d.module_id }" EXACT>
			<MvIF EXPR = "{ NOT Modules.d.EOF }">
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Custom module="' $ Modules.d.code $ '" code="' $ MMUI_CustomProductLayout.d.code $ '" />' ) }">				
			</MvIF>

			<MvSKIP NAME = "MMUI_CustomProductLayout" ROWS = 1>
		</MvWHILE>

		<MvGO NAME = "Modules" ROW = "{ l.recno }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				</Fields>' ) }">	

	<MvIF EXPR = "{ MMUI_ProductLayout.d.screen NE 'PRDS' }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Buttons>' ) }">	
		<MvIF EXPR = "{ MMUI_ProductLayout.d.adbutton }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Add />' ) }">				
		</MvIF>

		<MvIF EXPR = "{ MMUI_ProductLayout.d.bybutton }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Buy />' ) }">				
		</MvIF>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				</Buttons>' ) }">	
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Item>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Page_Update>' ) }">

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MMUI_Product_HeaderFooter" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MMUI_ProductHeaderFooter_Open }">
		<MvGO NAME = "MMUI_Products" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "MMUI_Products" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MMUI_CategoryHeaderFooter_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "MMUI_Products" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ MMUI_Products.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.product_found" VALUE = "{ Product_Find_ID( MMUI_Products.d.product_id ) }">
	<MvIF EXPR = "{ l.product_found }">
		<MvIF EXPR = "{ len( MMUI_Products.d.header ) OR len( MMUI_Products.d.footer ) }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		<Module code="cmp-mmui-pchdft" feature="component">' ) }">

			<MvIF EXPR = "{ len( MMUI_Products.d.header ) }">
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Product_Header product_code="' $ Products.d.code $ '">' ) }">	
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Template><![CDATA['					$ MMUI_Products.d.header	$ ']]></Template>' ) }">
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Notes>Upgrade from Miva Merchant v'	$ g.Merchant_Version		$ '</Notes>' ) }">
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Product_Header>' ) }">
			</MvIF>

			<MvIF EXPR = "{ len( MMUI_Products.d.footer ) }">
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Product_Footer product_code="' $ Products.d.code $ '">' ) }">	
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Template><![CDATA['					$ MMUI_Products.d.footer	$ ']]></Template>' ) }">
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Notes>Upgrade from Miva Merchant v'	$ g.Merchant_Version		$ '</Notes>' ) }">
				<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Product_Footer>' ) }">
			</MvIF>

			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "MMUI_ProductLayout_Format" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'X' }">			<MvFUNCTIONRETURN VALUE = "Expanded">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'L' }">	<MvFUNCTIONRETURN VALUE = "Line Item">
	</MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "MMUI_ProductLayout_Image" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'N' }">			<MvFUNCTIONRETURN VALUE = "None">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'L' }">	<MvFUNCTIONRETURN VALUE = "Full-Sized">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'S' }">	<MvFUNCTIONRETURN VALUE = "Thumbnail">
	</MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "MMUI_ProductLayout_Inventory" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'none' }">			<MvFUNCTIONRETURN VALUE = "None">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'short' }">	<MvFUNCTIONRETURN VALUE = "Short">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'long' }">	<MvFUNCTIONRETURN VALUE = "Long">
	</MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_EuroCurrency" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ EuroCurrency_Open_Store() }">
	<MvIF EXPR = "{ NOT l.opened }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Symbol>'				$ EuroCurrency.d.symbol			$ '</Symbol>' ) }">

	<MvIF EXPR = "{ EuroCurrency.d.after }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<SymbolPosition>After</SymbolPosition>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<SymbolPosition>Before</SymbolPosition>' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ThousandsSeparator>'	$ EuroCurrency.d.thousands									$ '</ThousandsSeparator>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<DecimalSeparator>'		$ EuroCurrency.d.decimal									$ '</DecimalSeparator>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Rate>'					$ EuroCurrency.d.rate										$ '</Rate>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EuroSymbol>'			$ EuroCurrency.d.eursymbol									$ '</EuroSymbol>' ) }">

	<MvIF EXPR = "{ EuroCurrency.d.euroafter }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EuroPosition>After</EuroPosition>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EuroPosition>Before</EuroPosition>' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Enclose>'				$ EuroCurrency_Enclose( EuroCurrency.d.enclose )			$ '</Enclose>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EncloseOpenSymbol>'	$ EuroCurrency.d.lbracket									$ '</EncloseOpenSymbol>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<EncloseCloseSymbol>'	$ EuroCurrency.d.rbracket									$ '</EncloseCloseSymbol>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<PrimaryCurrency>'		$ EuroCurrency_PrimaryCurrency( EuroCurrency.d.primecurr )	$ '</PrimaryCurrency>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "EuroCurrency_Enclose" PARAMETERS = "enclose" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.enclose EQ 'P' }">			<MvFUNCTIONRETURN VALUE = "Parentheses">
	<MvELSE> <MvIF EXPR = "{ l.enclose EQ 'A' }">	<MvFUNCTIONRETURN VALUE = "AngleBrackets">
	<MvELSE> <MvIF EXPR = "{ l.enclose EQ 'S' }">	<MvFUNCTIONRETURN VALUE = "SquareBrackets">
	<MvELSE>										<MvFUNCTIONRETURN VALUE = "Other">
	</MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "EuroCurrency_PrimaryCurrency" PARAMETERS = "primecurr" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.primecurr EQ 'E' }">		<MvFUNCTIONRETURN VALUE = "Euro">
	<MvELSE>									<MvFUNCTIONRETURN VALUE = "Other">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_GenericCurrency" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ GenericCurrency_Open_Store() }">
	<MvIF EXPR = "{ NOT l.opened }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvIF EXPR = "{ GenericCurrency.d.symbol }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Symbol>'				$ GenericCurrency.d.symbol					$ '</Symbol>' ) }">	
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Symbol>'				$ GenericCurrency.d.userdef					$ '</Symbol>' ) }">	
	</MvIF>
	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<GroupingSymbol>'			$ GenericCurrency.d.groupsym				$ '</GroupingSymbol>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<SeparatedSize>'			$ GenericCurrency.d.groupsize				$ '</SeparatedSize>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<DecimalSymbol>'			$ GenericCurrency.d.decimal					$ '</DecimalSymbol>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<DigitsAfterDecimal>'		$ GenericCurrency.d.decimsize				$ '</DigitsAfterDecimal>' ) }">

	<MvCOMMENT>
	|
	| Break down the positive format
	|
	</MvCOMMENT>

    <MvIF EXPR = "{ GenericCurrency.d.positive IN 'BD' }">	<MvASSIGN NAME = "l.symbolafteramount"  VALUE = 1>
	<MvELSE>												<MvASSIGN NAME = "l.symbolafteramount"  VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ GenericCurrency.d.positive IN 'CD' }">	<MvASSIGN NAME = "l.spaceseparate"      VALUE = 1>
	<MvELSE>												<MvASSIGN NAME = "l.spaceseparate"      VALUE = 0>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<PositiveFormat>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<SymbolAfterAmount>'	$ Upgrade5_Boolean( l.symbolafteramount )	$ '</SymbolAfterAmount>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<SpaceSeparate>'		$ Upgrade5_Boolean( l.spaceseparate )		$ '</SpaceSeparate>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</PositiveFormat>' ) }">

	<MvCOMMENT>
	|
	| Break down the negative format
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ GenericCurrency.d.negative IN 'EFGHIKNP' }">	<MvASSIGN NAME = "l.symbolafteramount"  VALUE = 1>
	<MvELSE>				                                        <MvASSIGN NAME = "l.symbolafteramount"  VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ GenericCurrency.d.negative IN 'IJKLMNOP' }">	<MvASSIGN NAME = "l.spaceseparate"      VALUE = 1>
	<MvELSE>														<MvASSIGN NAME = "l.spaceseparate"      VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ GenericCurrency.d.negative IN 'AEOP' }">		<MvASSIGN NAME = "l.enclose"            VALUE = "Parentheses">
	<MvELSE>														<MvASSIGN NAME = "l.enclose"            VALUE = "No">
	</MvIF>

	<MvIF EXPR = "{ GenericCurrency.d.negative IN 'DGHLN' }">		<MvASSIGN NAME = "l.minusafteramount"   VALUE = 1>
	<MvELSE>														<MvASSIGN NAME = "l.minusafteramount"   VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ GenericCurrency.d.negative IN 'CHKM' }">		<MvASSIGN NAME = "l.minusaftersymbol"   VALUE = 1>
	<MvELSE>														<MvASSIGN NAME = "l.minusaftersymbol"   VALUE = 0>
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<NegativeFormat>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<SymbolAfterAmount>'	$ Upgrade5_Boolean( l.symbolafteramount )	$ '</SymbolAfterAmount>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<SpaceSeparate>'		$ Upgrade5_Boolean( l.spaceseparate )		$ '</SpaceSeparate>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Enclose>'				$ l.enclose									$ '</Enclose>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<MinusAfterAmount>'		$ Upgrade5_Boolean( l.minusafteramount )	$ '</MinusAfterAmount>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<MinusAfterSymbol>'		$ Upgrade5_Boolean( l.minusaftersymbol )	$ '</MinusAfterSymbol>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</NegativeFormat>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_CustomerEmail" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| By sheer coincidence, this module uses the same database alias as one of the builtin databases, so make
	| sure the builtin db is not open.
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ g._DB_Store_CustomerEmail_Open }">
		<MvASSIGN NAME = "g._DB_Store_CustomerEmail_Open"	VALUE = 0>
		<MvCLOSE NAME = "CustomerEmail">
	</MvIF>

	<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ CustomerEmail_Open_Store() }">
	<MvIF EXPR = "{ NOT l.opened }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<From>'		$ CustomerEmail.d.from		$ '</From>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<CC>'		$ CustomerEmail.d.cc		$ '</CC>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Subject>'	$ CustomerEmail.d.subject	$ '</Subject>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Header>'	$ CustomerEmail.d.header	$ '</Header>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MerchantEmail" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ MerEmail_Open_Store() }">
	<MvIF EXPR = "{ NOT l.opened }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvIF EXPR = "{ MerEmail.d.use_from }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<From>'		$ MerEmail.d.from		$ '</From>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<From>Customer</From>' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<To>'		$ MerEmail.d.to			$ '</To>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<CC>'		$ MerEmail.d.cc			$ '</CC>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Subject>'	$ MerEmail.d.subject	$ '</Subject>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Header>'	$ MerEmail.d.header		$ '</Header>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_ELF" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ ELF_Open_Store() }">
	<MvIF EXPR = "{ NOT l.opened }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Format>'		$ ELF_Format( ELF.d.format )			$ '</Format>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<LogHostNames>'	$ Upgrade5_Boolean( ELF.d.hostnames )	$ '</LogHostNames>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<File>'			$ ELF.d.logfile							$ '</File>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ELF_Format" PARAMETERS = "format" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.format EQ 2 }">	<MvFUNCTIONRETURN VALUE = "ELF2">
	<MvELSE>							<MvFUNCTIONRETURN VALUE = "ELF">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MALF" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ MALF_Open_Store() }">
	<MvIF EXPR = "{ NOT l.opened }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<File>'	$ MALF.d.logfile	$ '</File>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_AmeriNet" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ AmeriNet_Open_Store() }">
	<MvIF EXPR = "{ NOT l.opened }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvIF EXPR = "{ AmeriNetConf.d.mode EQ 'D' }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<DebitFormat>' ) }">	
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<SiteId>'						$ AmeriNetConf.d.site_id					$ '</SiteId>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<ProductBillingId>'				$ AmeriNetConf.d.prod_id					$ '</ProductBillingId>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'							$ AmeriNetDbt.d.url							$ '</URL>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<DisplaySSN>'					$ Upgrade5_Boolean( AmeriNetDbt.d.ssn )		$ '</DisplaySSN>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<DisplayDriversLicenseNumber>'	$ Upgrade5_Boolean( AmeriNetDbt.d.dl_num )	$ '</DisplayDriversLicenseNumber>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<DisplayDriversLicenseState>'	$ Upgrade5_Boolean( AmeriNetDbt.d.dl_st )	$ '</DisplayDriversLicenseState>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</DebitFormat>' ) }">	
	<MvELSE> <MvIF EXPR = "{ AmeriNetConf.d.mode EQ 'C' }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<CheckGuarantee>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<SiteId>'						$ AmeriNetConf.d.site_id					$ '</SiteId>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<ProductBillingId>'				$ AmeriNetConf.d.prod_id					$ '</ProductBillingId>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'							$ AmeriNetChk.d.url							$ '</URL>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<DisplaySSN>'					$ Upgrade5_Boolean( AmeriNetChk.d.ssn )		$ '</DisplaySSN>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<DisplaySuffix>'				$ Upgrade5_Boolean( AmeriNetChk.d.suffix )	$ '</DisplaySuffix>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<DisplayGender>'				$ Upgrade5_Boolean( AmeriNetChk.d.gender )	$ '</DisplayGender>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</CheckGuarantee>' ) }">
	<MvELSE> <MvIF EXPR = "{ AmeriNetConf.d.mode EQ 'A' }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<AuthorizationOnly>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<SiteId>'						$ AmeriNetConf.d.site_id					$ '</SiteId>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<ProductBillingId>'				$ AmeriNetConf.d.prod_id					$ '</ProductBillingId>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'							$ AmeriNetAth.d.url							$ '</URL>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</AuthorizationOnly>' ) }">
	</MvIF> </MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AmeriNet_Mode" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.code" VALUE = "{ tolower( l.code ) }">
	
	<MvIF EXPR = "{ l.code EQ 'd' }">			<MvFUNCTIONRETURN VALUE = "DebitFormat">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'c' }">	<MvFUNCTIONRETURN VALUE = "CheckGuarantee">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'a' }">	<MvFUNCTIONRETURN VALUE = "AuthorizationOnly">	
	</MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_AuthorizeNet" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_AuthorizeNet_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ AuthorizeNet_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_AuthorizeNet_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_AuthorizeNet_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_AuthorizeNet_Method( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_AuthorizeNet_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<LoginID>'				$ AuthorizeNet.d.login_id						$ '</LoginID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TransactionKey>'		$ AuthorizeNet.d.tran_key						$ '</TransactionKey>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'					$ AuthorizeNet.d.url							$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<MD5SecurityCode>'		$ AuthorizeNet.d.mdhash							$ '</MD5SecurityCode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<CVVMessage><![CDATA['	$ AuthorizeNet.d.cvv_msg						$ ']]></CVVMessage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Mode>'					$ AuthorizeNet_Mode( AuthorizeNet.d.authcapt )	$ '</Mode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<SecureSource>'			$ Upgrade5_Boolean( AuthorizeNet.d.secsrc )		$ '</SecureSource>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<FullCCNumber>'			$ Upgrade5_Boolean( AuthorizeNet.d.full_cc )	$ '</FullCCNumber>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TestMode>'				$ Upgrade5_Boolean( AuthorizeNet.d.test_mode )	$ '</TestMode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AuthorizeNet_Mode" PARAMETERS = "authcapt" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.authcapt }">	<MvFUNCTIONRETURN VALUE = "Capture">
	<MvELSE>						<MvFUNCTIONRETURN VALUE = "PreAuth">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_AuthorizeNet_Method" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_AuthorizeNetMethods_Open }">
		<MvGO NAME = "AuthorizeNetMethods" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "AuthorizeNetMethods" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_AuthorizeNetMethods_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "AuthorizeNetMethods" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ AuthorizeNetMethods.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ AuthorizeNetMethods.d.enabled }">
		<MvIF EXPR = "{ AuthorizeNetMethods.d.cvv }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ AuthorizeNet_Method( AuthorizeNetMethods.d.code ) $ '" cvv />' ) }">
		<MvELSE>
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ AuthorizeNet_Method( AuthorizeNetMethods.d.code ) $ '" />' ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "AuthorizeNet_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'Visa' }">				<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'MasterCard' }">	<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'Discover' }">	<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'AmerExp' }">	<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'ACH' }">		<MvFUNCTIONRETURN VALUE = "Check">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DC' }">			<MvFUNCTIONRETURN VALUE = "Diner">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'JCB' }">		<MvFUNCTIONRETURN VALUE = "JCB">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_COD" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ COD_Open_Store() }">
	<MvIF EXPR = "{ NOT l.opened }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Price>'			$ CODConf.d.price	$ '</Price>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Message><![CDATA['	$ CODConf.d.message	$ ']]></Message>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_eSELECT" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "card">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_eSELECT_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ eSELECT_OpenStore() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_eSELECT_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_eSELECT_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'card' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_eSELECT_Card( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_eSELECT_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Mode>'			$ eSELECT_Mode( eSELECT.d.code )	$ '</Mode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<AccountToken>'	$ eSELECT.d.accnttoken				$ '</AccountToken>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "eSELECT_Mode" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 1 }">	<MvFUNCTIONRETURN VALUE = "Capture">
	<MvELSE>						<MvFUNCTIONRETURN VALUE = "PreAuth">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_eSELECT_Card" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_eSELECTCards_Open }">
		<MvGO NAME = "eSELECTCards" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "eSELECTCards" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_eSELECTCards_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "eSELECTCards" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ eSELECTCards.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ eSELECTCards.d.enabled }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ eSELECT_Method( eSELECTCards.d.code ) $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "eSELECT_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'VISA' }">					<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'MASTERCARD' }">		<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DISCOVER' }">		<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'AMEX' }">			<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DINERS' }">			<MvFUNCTIONRETURN VALUE = "Diner">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'CARD_BRAND_1' }">	<MvFUNCTIONRETURN VALUE = "JCB">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_eValuCheck" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ eValCheck_Open_Store() }">
	<MvIF EXPR = "{ NOT l.opened }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>


	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ExchangeID>'				$ eValCheckVal.d.exch_id		$ '</ExchangeID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<MerchantID>'				$ eValCheckVal.d.mrch_id		$ '</MerchantID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Password>'					$ eValCheckVal.d.mrch_pass		$ '</Password>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<URL>'						$ eValCheckVal.d.url			$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ErrorMessage><![CDATA['	$ eValCheckVal.d.err_msg		$ ']]></ErrorMessage>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_GlobalComm" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_GlobalComm_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ GlobalComm_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_GlobalComm_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_GlobalComm_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_GlobalComm_Method( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_GlobalComm_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<AccountID>'	$ GlobalComm.d.ats_id						$ '</AccountID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<AccountSubID>'	$ GlobalComm.d.sub_id						$ '</AccountSubID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'			$ GlobalComm.d.url							$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<FullCCNumber>'	$ Upgrade5_Boolean( GlobalComm.d.store_cc )	$ '</FullCCNumber>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Mode>'			$ GlobalComm_Mode( GlobalComm.d.postauth )	$ '</Mode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "GlobalComm_Mode" PARAMETERS = "postauth" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.postauth }">	<MvFUNCTIONRETURN VALUE = "PreAuth">
	<MvELSE>						<MvFUNCTIONRETURN VALUE = "Capture">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_GlobalComm_Method" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_GlobalCommMethods_Open }">
		<MvGO NAME = "GlobalCommMethods" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "GlobalCommMethods" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_GlobalCommMethods_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "GlobalCommMethods" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ GlobalCommMethods.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ GlobalCommMethods.d.enabled }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ GlobalComm_Method( GlobalCommMethods.d.code ) $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "GlobalComm_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'ax' }">			<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'cb' }">	<MvFUNCTIONRETURN VALUE = "CB">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'dc' }">	<MvFUNCTIONRETURN VALUE = "Diner">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'ds' }">	<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'mc' }">	<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'ec' }">	<MvFUNCTIONRETURN VALUE = "Check">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'vs' }">	<MvFUNCTIONRETURN VALUE = "Visa">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_ICS2" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "card">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_ICS2_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ ICS2_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_ICS2_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_ICS2_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'card' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_ICS2_Card( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_ICS2_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<MerchantID>'			$ ICS2.d.merchant						$ '</MerchantID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'					$ ICS2.d.url							$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Currency>'				$ ICS2.d.currency						$ '</Currency>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<FullCCNumber>'			$ Upgrade5_Boolean( ICS2.d.store_cc )	$ '</FullCCNumber>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<CVVMessage><![CDATA['	$ ICS2.d.cvv_msg						$ ']]></CVVMessage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_ICS2_Card" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_ICS2Cards_Open }">
		<MvGO NAME = "ICS2Cards" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "ICS2Cards" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_ICS2Cards_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "ICS2Cards" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ICS2Cards.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ ICS2Cards.d.enabled }">
		<MvIF EXPR = "{ ICS2Cards.d.cvv }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ ICS2_Method( ICS2Cards.d.code ) $ '" cvv />' ) }">
		<MvELSE>
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ ICS2_Method( ICS2Cards.d.code ) $ '" />' ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "ICS2_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'VISA' }">				<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'MASTERCARD' }">	<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DISCOVER' }">	<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'AMEX' }">		<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DINER' }">		<MvFUNCTIONRETURN VALUE = "Diner">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_IgsGroup" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_IgsGroup_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ IgsGroup_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_IgsGroup_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_IgsGroup_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_IgsGroup_Method( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_IgsGroup_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Login>'				$ IgsGroup.d.login							$ '</Login>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Password>'				$ IgsGroup.d.password						$ '</Password>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'					$ IgsGroup.d.url							$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Mode>'					$ IgsGroup_Mode( IgsGroup.d.capture )		$ '</Mode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<FullCCNumber>'			$ Upgrade5_Boolean( IgsGroup.d.full_cc )	$ '</FullCCNumber>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TestMode>'				$ Upgrade5_Boolean( IgsGroup.d.test )		$ '</TestMode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<CVVMessage><![CDATA['	$ IgsGroup.d.cvv_msg						$ ']]></CVVMessage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "IgsGroup_Mode" PARAMETERS = "capture" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.capture }">	<MvFUNCTIONRETURN VALUE = "PreAuth">
	<MvELSE>						<MvFUNCTIONRETURN VALUE = "Capture">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_IgsGroup_Method" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_IgsGroupMethods_Open }">
		<MvGO NAME = "IgsGroupMethods" ROW = "top">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "IgsGroupMethods" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_IgsGroupMethods_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "IgsGroupMethods" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ IgsGroupMethods.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ IgsGroupMethods.d.enabled }">
		<MvIF EXPR = "{ IgsGroupMethods.d.cvv }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ IgsGroup_Method( IgsGroupMethods.d.code ) $ '" cvv />' ) }">
		<MvELSE>
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ IgsGroup_Method( IgsGroupMethods.d.code ) $ '" />' ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "IgsGroup_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'visa' }">				<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'mc' }">			<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'amex' }">		<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'diners' }">		<MvFUNCTIONRETURN VALUE = "Diner">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'discover' }">	<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'jcb' }">		<MvFUNCTIONRETURN VALUE = "JCB">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_LinkPoint" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "card">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_LinkPoint_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ LinkPoint_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_LinkPoint_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_LinkPoint_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'card' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_LinkPoint_Card( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_LinkPoint_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<StoreName>'			$ LinkPoint.d.storename						$ '</StoreName>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'					$ LinkPoint.d.host							$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Port>'					$ LinkPoint.d.port							$ '</Port>' ) }">

	<MvASSIGN NAME = "l.certfile" VALUE = "{ '/LinkPoint/' $ LinkPoint.d.storename $ '.pem' }">	
	<MvIF EXPR = "{ fexists( l.certfile ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Certificate><![CDATA[' ) }">

		<MvIMPORT FILE		= "{ l.certfile }"
				  FIELDS	= "l.line"
				  DELIMITER	= "">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( l.line ) }">
		</MvIMPORT>

		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				]]></Certificate>' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Mode>'					$ LinkPoint_Mode( LinkPoint.d.preauth )		$ '</Mode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<FullCCNumber>'			$ Upgrade5_Boolean( LinkPoint.d.store_cc )	$ '</FullCCNumber>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TestMode>'				$ Upgrade5_Boolean( LinkPoint.d.testmode )	$ '</TestMode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<CreditVerification>'	$ Upgrade5_Boolean( LinkPoint.d.cvm )		$ '</CreditVerification>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<CVVMessage><![CDATA['	$ LinkPoint.d.cvv_msg						$ ']]></CVVMessage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<AVSAddress>'			$ Upgrade5_Boolean( LinkPoint.d.avs_addr )	$ '</AVSAddress>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<AVSZip>'				$ Upgrade5_Boolean( LinkPoint.d.avs_zip )	$ '</AVSZip>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "LinkPoint_Mode" PARAMETERS = "preauth" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.preauth }">	<MvFUNCTIONRETURN VALUE = "PreAuth">
	<MvELSE>						<MvFUNCTIONRETURN VALUE = "Capture">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_LinkPoint_Card" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_LinkPointCards_Open }">
		<MvGO NAME = "LinkPointCards" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "LinkPointCards" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_LinkPointCards_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "LinkPointCards" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ LinkPointCards.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ LinkPointCards.d.enabled }">
		<MvIF EXPR = "{ LinkPointCards.d.cvv }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ LinkPoint_Method( LinkPointCards.d.code ) $ '" cvv />' ) }">
		<MvELSE>
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ LinkPoint_Method( LinkPointCards.d.code ) $ '" />' ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "LinkPoint_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'vs' }">			<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'mc' }">	<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'ds' }">	<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'ax' }">	<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'dc' }">	<MvFUNCTIONRETURN VALUE = "Diner">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_LynkSystems" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "card">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_LynkSys_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ LynkSys_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_LynkSys_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_LynkSystems_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'card' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_LynkSystems_Card( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_LynkSystems_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'					$ LynkSys.d.url								$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<StoreID>'				$ LynkSys.d.store_id						$ '</StoreID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TerminalID>'			$ LynkSys.d.term_id							$ '</TerminalID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<MerchantID>'			$ LynkSys.d.merch_id						$ '</MerchantID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Username>'				$ LynkSys.d.username						$ '</Username>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Password>'				$ LynkSys.d.password						$ '</Password>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<FullCCNumber>'			$ Upgrade5_Boolean( LynkSys.d.store_cc )	$ '</FullCCNumber>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Mode>'					$ LynkSys_Mode( LynkSys.d.authcapt )		$ '</Mode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<CVVMessage><![CDATA['	$ LynkSys.d.cvv_msg							$ ']]></CVVMessage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "LynkSys_Mode" PARAMETERS = "authcapt" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.authcapt }">	<MvFUNCTIONRETURN VALUE = "PreAuth">
	<MvELSE>						<MvFUNCTIONRETURN VALUE = "Capture">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_LynkSystems_Card" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_LynkSysCards_Open }">
		<MvGO NAME = "LynkSysCards" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "LynkSysCards" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_LynkSysCards_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "LynkSysCards" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ LynkSysCards.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ LynkSysCards.d.enabled }">
		<MvIF EXPR = "{ LynkSysCards.d.cvv }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ LynkSys_Method( LynkSysCards.d.code ) $ '" cvv />' ) }">
		<MvELSE>
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ LynkSys_Method( LynkSysCards.d.code ) $ '" />' ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "LynkSys_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'Visa' }">				<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'MasterCard' }">	<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'Discover' }">	<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'Amex' }">		<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'Diners' }">		<MvFUNCTIONRETURN VALUE = "Diner">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'JCB' }">		<MvFUNCTIONRETURN VALUE = "JCB">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MOD10" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MOD10Cards_Open }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ MOD10_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "MOD10Cards" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MOD10Cards_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "MOD10Cards" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ MOD10Cards.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Card_Add>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Name>'				$ MOD10Cards.d.name		$ '</Name>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<ValidPrefixes>'	$ MOD10Cards.d.prefixes	$ '</ValidPrefixes>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<ValidLengths>'		$ MOD10Cards.d.lengths	$ '</ValidLengths>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Card_Add>' ) }">	

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MvPay" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "card">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MvPay_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ MvPay_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MvPay_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MvPay_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'card' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MvPay_Card( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MvPay_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<MerchantID>'			$ MvPayConf.d.merchant						$ '</MerchantID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'					$ MvPayConf.d.url							$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<FullCCNumber>'			$ Upgrade5_Boolean( MvPayConf.d.store_cc )	$ '</FullCCNumber>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<CVVMessage><![CDATA['	$ MvPayConf.d.cvv_msg						$ ']]></CVVMessage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MvPay_Card" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MvPayCards_Open }">
		<MvGO NAME = "MvPayCards" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "MvPayCards" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MvPayCards_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "MvPayCards" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ MvPayCards.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ MvPayCards.d.enabled }">
		<MvIF EXPR = "{ MvPayCards.d.cvv }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ MvPay_Method( MvPayCards.d.code ) $ '" cvv />' ) }">
		<MvELSE>
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ MvPay_Method( MvPayCards.d.code ) $ '" />' ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "MvPay_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'VISA' }">				<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'MASTERCARD' }">	<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DISCOVER' }">	<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'AMEX' }">		<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DINER' }">		<MvFUNCTIONRETURN VALUE = "Diner">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'JCB' }">		<MvFUNCTIONRETURN VALUE = "JCB">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_Paradata" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "card">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_Paradata_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ Paradata_OpenStore() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_Paradata_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_Paradata_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'card' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_Paradata_Card( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_Paradata_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<AccountToken>'	$ Paradata.d.accntToken					$ '</AccountToken>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Mode>'			$ Paradata_Mode( Paradata.d.capture )	$ '</Mode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Paradata_Mode" PARAMETERS = "capture" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.capture }">	<MvFUNCTIONRETURN VALUE = "Capture">
	<MvELSE>						<MvFUNCTIONRETURN VALUE = "PreAuth">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_Paradata_Card" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_ParadataCards_Open }">
		<MvGO NAME = "ParadataCards" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "ParadataCards" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_ParadataCards_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "ParadataCards" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ParadataCards.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ ParadataCards.d.enabled }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ Paradata_Method( ParadataCards.d.code ) $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Paradata_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'VISA' }">					<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'MASTERCARD' }">		<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DISCOVER' }">		<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'AMEX' }">			<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DINERS' }">			<MvFUNCTIONRETURN VALUE = "Diner">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'CARD_BRAND_1' }">	<MvFUNCTIONRETURN VALUE = "JCB">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PayLink" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "card">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_PayLink_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ PayLink_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_PayLink_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_PayLink_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'card' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_PayLink_Card( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PayLink_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<UserID>'				$ PayLink.d.user					$ '</UserID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Password>'				$ PayLink.d.password				$ '</Password>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'					$ PayLink.d.url						$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Mode>'					$ PayLink_Mode( PayLink.d.type )	$ '</Mode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<CVVMessage><![CDATA['	$ PayLink.d.cvv_msg					$ ']]></CVVMessage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PayLink_Mode" PARAMETERS = "type" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.type EQ 'A' }">			<MvFUNCTIONRETURN VALUE = "PreAuth">
	<MvELSE> <MvIF EXPR = "{ l.type EQ 'S' }">	<MvFUNCTIONRETURN VALUE = "Capture">
	</MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PayLink_Card" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_PayLinkCards_Open }">
		<MvGO NAME = "PayLinkCards" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "PayLinkCards" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_PayLinkCards_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "PayLinkCards" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ PayLinkCards.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ PayLinkCards.d.enabled }">
		<MvIF EXPR = "{ PayLinkCards.d.cvv }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ PayLink_Method( PayLinkCards.d.code ) $ '" cvv />' ) }">
		<MvELSE>
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ PayLink_Method( PayLinkCards.d.code ) $ '" />' ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "PayLink_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'VISA' }">				<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'MASTERCARD' }">	<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'AMEX' }">		<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DINER' }">		<MvFUNCTIONRETURN VALUE = "Diner">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DISCOVER' }">	<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'JCB' }">		<MvFUNCTIONRETURN VALUE = "JCB">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'TCH' }">		<MvFUNCTIONRETURN VALUE = "Check">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PaymentNet" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "card">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_PaymentNet_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ PaymentNet_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_PaymentNet_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_PaymentNet_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'card' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_PaymentNet_Card( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PaymentNet_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<UserID>'				$ PaymentNet.d.user							$ '</UserID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Password>'				$ PaymentNet.d.password						$ '</Password>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Host>'					$ PaymentNet.d.host							$ '</Host>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Port>'					$ PaymentNet.d.port							$ '</Port>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Vendor>'				$ PaymentNet.d.vendor						$ '</Vendor>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Partner>'				$ PaymentNet.d.partner						$ '</Partner>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<ProxyAddress>'			$ PaymentNet.d.proxyaddr					$ '</ProxyAddress>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<ProxyPort>'			$ PaymentNet.d.proxyport					$ '</ProxyPort>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<ProxyLogon>'			$ PaymentNet.d.proxylogon					$ '</ProxyLogon>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<ProxyPassword>'		$ PaymentNet.d.proxypass					$ '</ProxyPassword>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<FullCCNumber>'			$ Upgrade5_Boolean( PaymentNet.d.store_cc )	$ '</FullCCNumber>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Mode>'					$ PaymentNet_Mode( PaymentNet.d.authcapt )	$ '</Mode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<CVVMessage><![CDATA['	$ PaymentNet.d.cvv_msg						$ ']]></CVVMessage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PaymentNet_Mode" PARAMETERS = "authcapt" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.authcapt }">	<MvFUNCTIONRETURN VALUE = "Capture">
	<MvELSE>						<MvFUNCTIONRETURN VALUE = "PreAuth">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PaymentNet_Card" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_PaymentNetCards_Open }">
		<MvGO NAME = "PaymentNetCards" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "PaymentNetCards" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_PaymentNetCards_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "PaymentNetCards" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ PaymentNetCards.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ PaymentNetCards.d.enabled }">
		<MvIF EXPR = "{ PaymentNetCards.d.cvv }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ PaymentNet_Method( PaymentNetCards.d.code ) $ '" cvv />' ) }">
		<MvELSE>
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ PaymentNet_Method( PaymentNetCards.d.code ) $ '" />' ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "PaymentNet_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'VISA' }">				<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'MASTERCARD' }">	<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'AMEX' }">		<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DINER' }">		<MvFUNCTIONRETURN VALUE = "Diner">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DISCOVER' }">	<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'JCB' }">		<MvFUNCTIONRETURN VALUE = "JCB">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PayPal" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ PayPal_Open_Store() }">
	<MvIF EXPR = "{ NOT l.opened }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Email>'			$ PayPal.d.email	$ '</Email>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<URL>'				$ PayPal.d.url		$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Currency>'			$ PayPal.d.curr		$ '</Currency>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Message><![CDATA['	$ PayPal.d.message	$ ']]></Message>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PayQuake" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_PayQuake_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ PayQuake_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_PayQuake_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_PayQuake_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_PayQuake_Method( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PayQuake_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<LoginID>'				$ PayQuake.d.login_id						$ '</LoginID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TransactionKey>'		$ PayQuake.d.tran_key						$ '</TransactionKey>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'					$ PayQuake.d.url							$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<MD5SecurityCode>'		$ PayQuake.d.mdhash							$ '</MD5SecurityCode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<CVVMessage><![CDATA['	$ PayQuake.d.cvv_msg						$ ']]></CVVMessage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Mode>'					$ PayQuake_Mode( PayQuake.d.authcapt )		$ '</Mode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<SecureSource>'			$ Upgrade5_Boolean( PayQuake.d.secsrc )		$ '</SecureSource>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<FullCCNumber>'			$ Upgrade5_Boolean( PayQuake.d.full_cc )	$ '</FullCCNumber>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TestMode>'				$ Upgrade5_Boolean( PayQuake.d.test_mode )	$ '</TestMode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PayQuake_Mode" PARAMETERS = "authcapt" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.authcapt }">	<MvFUNCTIONRETURN VALUE = "Capture">
	<MvELSE>						<MvFUNCTIONRETURN VALUE = "PreAuth">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PayQuake_Method" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_PayQuakeMethods_Open }">
		<MvGO NAME = "PayQuakeMethods" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "PayQuakeMethods" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_PayQuakeMethods_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "PayQuakeMethods" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ PayQuakeMethods.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ PayQuakeMethods.d.enabled }">
		<MvIF EXPR = "{ PayQuakeMethods.d.cvv }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ PayQuake_Method( PayQuakeMethods.d.code ) $ '" cvv />' ) }">
		<MvELSE>
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ PayQuake_Method( PayQuakeMethods.d.code ) $ '" />' ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "PayQuake_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'Visa' }">				<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'MasterCard' }">	<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'Discover' }">	<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'AmerExp' }">	<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'ACH' }">		<MvFUNCTIONRETURN VALUE = "Check">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'DC' }">			<MvFUNCTIONRETURN VALUE = "Diner">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'JCB' }">		<MvFUNCTIONRETURN VALUE = "JCB">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_QuickCommerce" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_QuickCommerce_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ QuickCommerce_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_QuickCommerce_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_QuickCommerce_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_QuickCommerce_Method( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_QuickCommerce_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<LoginID>'				$ QuickCommerce.d.login_id							$ '</LoginID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TransactionKey>'		$ QuickCommerce.d.password							$ '</TransactionKey>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'					$ QuickCommerce.d.url								$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Mode>'					$ QuickCommerce_Mode( QuickCommerce.d.authcapt )	$ '</Mode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<FullCCNumber>'			$ Upgrade5_Boolean( QuickCommerce.d.full_cc )		$ '</FullCCNumber>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TestMode>'				$ Upgrade5_Boolean( QuickCommerce.d.test_mode )		$ '</TestMode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "QuickCommerce_Mode" PARAMETERS = "authcapt" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.authcapt }">	<MvFUNCTIONRETURN VALUE = "Capture">
	<MvELSE>						<MvFUNCTIONRETURN VALUE = "PreAuth">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_QuickCommerce_Method" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_QuickCommerceMethods_Open }">
		<MvGO NAME = "QuickCommerceMethods" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "QuickCommerceMethods" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_QuickCommerceMethods_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "QuickCommerceMethods" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ QuickCommerceMethods.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ QuickCommerceMethods.d.enabled }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ QuickCommerce_Method( QuickCommerceMethods.d.code ) $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "QuickCommerce_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'Visa' }">				<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'MasterCard' }">	<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'Discover' }">	<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'AmerExp' }">	<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'ACH' }">		<MvFUNCTIONRETURN VALUE = "Check">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_Rodopi" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_Rodopi_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ Rodopi_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_Rodopi_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_Rodopi_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_Rodopi_Method( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_Rodopi_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Login>'		$ RodPay.d.login							$ '</Login>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Password>'		$ RodPay.d.password							$ '</Password>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'			$ RodPay.d.url								$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Currency>'		$ Rodopi_Currency( RodPay.d.curr_sym )		$ '</Currency>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Mode>'			$ Rodopi_Mode( RodPay.d.authcapt )			$ '</Mode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<FullCCNumber>'	$ Upgrade5_Boolean( RodPay.d.full_cc )		$ '</FullCCNumber>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TestMode>'		$ Upgrade5_Boolean( RodPay.d.test_mode )	$ '</TestMode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Rodopi_Mode" PARAMETERS = "authcapt" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.authcapt EQ 1 }">				<MvFUNCTIONRETURN VALUE = "Capture">
	<MvELSE> <MvIF EXPR = "{ l.authcapt EQ 2 }">	<MvFUNCTIONRETURN VALUE = "PreAuth">
	</MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Rodopi_Currency" PARAMETERS = "curr_sym" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.curr_sym EQ 1 }">				<MvFUNCTIONRETURN VALUE = "USD">
	<MvELSE> <MvIF EXPR = "{ l.curr_sym EQ 2 }">	<MvFUNCTIONRETURN VALUE = "CAD">
	<MvELSE> <MvIF EXPR = "{ l.curr_sym EQ 3 }">	<MvFUNCTIONRETURN VALUE = "FRF">
	<MvELSE> <MvIF EXPR = "{ l.curr_sym EQ 4 }">	<MvFUNCTIONRETURN VALUE = "DKM">
	<MvELSE> <MvIF EXPR = "{ l.curr_sym EQ 5 }">	<MvFUNCTIONRETURN VALUE = "IEP">
	<MvELSE> <MvIF EXPR = "{ l.curr_sym EQ 6 }">	<MvFUNCTIONRETURN VALUE = "JPY">
	<MvELSE> <MvIF EXPR = "{ l.curr_sym EQ 7 }">	<MvFUNCTIONRETURN VALUE = "NLG">
	<MvELSE> <MvIF EXPR = "{ l.curr_sym EQ 8 }">	<MvFUNCTIONRETURN VALUE = "GBP">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_Rodopi_Method" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_RodPayMethods_Open }">
		<MvGO NAME = "RodPayMethods" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "RodPayMethods" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_RodPayMethods_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "RodPayMethods" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ RodPayMethods.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ RodPayMethods.d.enabled }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ Rodopi_Method( RodPayMethods.d.code ) $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Rodopi_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'Visa' }">					<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'MasterCard' }">		<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'Discover' }">		<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'AmerExp' }">		<MvFUNCTIONRETURN VALUE = "Amex">
	</MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_USMS" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_USMS_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ USMS_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_USMS_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_USMS_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_USMS_Method( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_USMS_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Login>'				$ InfPay.d.login						$ '</Login>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Password>'				$ InfPay.d.password						$ '</Password>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TerminalID>'			$ InfPay.d.t_id							$ '</TerminalID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<MerchantID>'			$ InfPay.d.m_id							$ '</MerchantID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'					$ InfPay.d.url							$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Mode>'					$ USMS_Mode( InfPay.d.capture )			$ '</Mode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<FullCCNumber>'			$ Upgrade5_Boolean( InfPay.d.full_cc )	$ '</FullCCNumber>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TestMode>'				$ Upgrade5_Boolean( InfPay.d.test )		$ '</TestMode>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<CVVMessage><![CDATA['	$ InfPay.d.cvv_msg						$ ']]></CVVMessage>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "USMS_Mode" PARAMETERS = "capture" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.capture }">	<MvFUNCTIONRETURN VALUE = "PreAuth">
	<MvELSE>						<MvFUNCTIONRETURN VALUE = "Capture">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_USMS_Method" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_InfMethods_Open }">
		<MvGO NAME = "InfMethods" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "InfMethods" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_InfMethods_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "InfMethods" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ InfMethods.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ InfMethods.d.enabled }">
		<MvIF EXPR = "{ InfMethods.d.cvv }">
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ USMS_Method( InfMethods.d.code ) $ '" cvv />' ) }">
		<MvELSE>
			<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ USMS_Method( InfMethods.d.code ) $ '" />' ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "USMS_Method" PARAMETERS = "code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.code EQ 'Visa' }">				<MvFUNCTIONRETURN VALUE = "Visa">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'MasterCard' }">	<MvFUNCTIONRETURN VALUE = "MasterCard">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'Amex' }">		<MvFUNCTIONRETURN VALUE = "Amex">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'Discover' }">	<MvFUNCTIONRETURN VALUE = "Discover">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'Diners' }">		<MvFUNCTIONRETURN VALUE = "Diner">
	<MvELSE> <MvIF EXPR = "{ l.code EQ 'JCB' }">		<MvFUNCTIONRETURN VALUE = "JCB">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_BaseUnit" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_BaseUnit_Open }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ BaseUnit_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "BaseUnit" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_BaseUnit_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "BaseUnit" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ BaseUnit.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Method_Add>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method>'	$ BaseUnit.d.method	$ '</Method>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Base>'		$ BaseUnit.d.base	$ '</Base>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Rate>'		$ BaseUnit.d.rate	$ '</Rate>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Method_Add>' ) }">	

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_FlatRate" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_FlatRate_Open }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ FlatRate_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "FlatRate" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_FlatRate_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "FlatRate" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ FlatRate.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Method_Add>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method>'	$ FlatRate.d.method	$ '</Method>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Cost>'		$ FlatRate.d.cost	$ '</Cost>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Method_Add>' ) }">	

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MinUnit" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MinUnit_Open }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ MinUnit_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "MinUnit" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MinUnit_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "MinUnit" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ MinUnit.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Method_Add>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method>'	$ MinUnit.d.method	$ '</Method>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Minimum>'	$ MinUnit.d.minimum	$ '</Minimum>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Rate>'		$ MinUnit.d.rate	$ '</Rate>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Method_Add>' ) }">	

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MvFedEx" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MvFedEx_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ MvFedEx_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MvFedEx_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MvFedEx_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MvFedEx_Method( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MvFedEx_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	

	<MvIF EXPR = "{ MvFedEx_Settings.d.server_sel EQ 'test' }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Server>Test</Server>' ) }">
	<MvELSE> <MvIF EXPR = "{ MvFedEx_Settings.d.server_sel EQ 'prod' }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Server>Production</Server>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Server>'			$ MvFedEx_Settings.d.server							$ '</Server>' ) }">
	</MvIF> </MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<AccountID>'			$ MvFedEx_Settings.d.account						$ '</AccountID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<MeterID>'				$ MvFedEx_Settings.d.meter							$ '</MeterID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<HandlingBase>'			$ MvFedEx_Settings.d.hand_base						$ '</HandlingBase>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<HandlingPercent>'		$ MvFedEx_Settings.d.hand_pct						$ '</HandlingPercent>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<HandlingMinimum>'		$ MvFedEx_Settings.d.hand_min						$ '</HandlingMinimum>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<DropOffType>'			$ MvFedEx_DropOff( MvFedEx_Settings.d.drop_off )	$ '</DropOffType>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<SignatureRequired>'	$ Upgrade5_Boolean( MvFedEx_Settings.d.signature )	$ '</SignatureRequired>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "MvFedEx_DropOff" PARAMETERS = "drop_off" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.drop_off EQ 1 }">				<MvFUNCTIONRETURN VALUE = "Regular Pickup">
	<MvELSE> <MvIF EXPR = "{ l.drop_off EQ 2 }">	<MvFUNCTIONRETURN VALUE = "Request Courier">
	<MvELSE> <MvIF EXPR = "{ l.drop_off EQ 3 }">	<MvFUNCTIONRETURN VALUE = "Drop Box">
	<MvELSE> <MvIF EXPR = "{ l.drop_off EQ 4 }">	<MvFUNCTIONRETURN VALUE = "Drop at BSC">
	<MvELSE> <MvIF EXPR = "{ l.drop_off EQ 5 }">	<MvFUNCTIONRETURN VALUE = "Drop at Station">
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MvFedEx_Method" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MvFedEx_Services_Open }">
		<MvGO NAME = "MvFedEx_Services" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "MvFedEx_Services" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MvFedEx_Services_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "MvFedEx_Services" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ MvFedEx_Services.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ MvFedEx_Services.d.enabled }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ MvFedEx_Services.d.name $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MvUSPS" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_MvUSPS_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ USPS_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_MvUSPS_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MvUSPS_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_MvUSPS_Method( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MvUSPS_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'			$ USPS.d.url		$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<SourceZip>'	$ USPS.d.sourcezip	$ '</SourceZip>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<UserID>'		$ USPS.d.userid		$ '</UserID>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Password>'		$ USPS.d.password	$ '</Password>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Handling>'		$ USPS.d.handling	$ '</Handling>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_MvUSPS_Method" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_USPSMethods_Open }">
		<MvGO NAME = "USPSMethods" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "USPSMethods" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_USPSMethods_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "USPSMethods" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ USPSMethods.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ USPSMethods.d.enabled }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ USPSMethods.d.name $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_UPS" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvIF EXPR = "{ fexists( g.MerchantPath $ padl( Stores.d.id, 8, '0' ) $ '/upscost/download/upssvcs.dbf' ) }">
			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "download">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "charges_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "charge">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
			<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "charges_end">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		</MvIF>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_UPS_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ MvUPS_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_UPS_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_UPS_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'download' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_UPS_Download( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_UPS_Method( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_EnabledMethods_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'charges_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_UPS_EnabledCharges_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'charge' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_UPS_Charge( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'charges_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_UPS_EnabledCharges_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_UPS_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<SourceZip>'					$ MvUPSCost.d.src_zip	$ '</SourceZip>' ) }">

	<MvIF EXPR = "{ MvUPSCost.d.fee_type EQ 'F' }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Handling type="fee">'		$ MvUPSCost.d.handling	$ '</Handling>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Handling type="percent">'	$ MvUPSCost.d.handling	$ '</Handling>' ) }">
	</MvIF>
	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<URL>'							$ MvUPSCost.d.server	$ '</URL>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<GroundFuelSurcharge>'			$ MvUPSCost.d.fuel		$ '</GroundFuelSurcharge>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_UPS_Download" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<DownloadTables />' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_UPS_Method" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_UPS_Services_Open }">
		<MvIF EXPR = "{ NOT g.Upgrade5_Module_UPS_Download_Open }">
			<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ MvUPS_Download_Open_Store() }">
			<MvIF EXPR = "{ NOT l.opened }">
				<MvCOMMENT>
				|
				| Not a fatal error because the user may not have downloaded the tables/services
				|
				</MvCOMMENT>

				<MvFUNCTIONRETURN VALUE = 1>
			</MvIF>

			<MvASSIGN NAME = "g.Upgrade5_Module_UPS_Download_Open" VALUE = 1>
		</MvIF>

		<MvGO NAME = "UPS_Services" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "UPS_Services" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_UPS_Services_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "UPS_Services" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ UPS_Services.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvFIND NAME = "MvUPSMethods" VALUE = "{ UPS_Services.d.id }" EXACT>
	<MvIF EXPR = "{ NOT MvUPSMethods.d.EOF }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method code="' $ UPS_Services.d.service $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_UPS_EnabledCharges_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Enabled_Charges>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_UPS_Charge" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_UPS_Charges_Open }">
		<MvIF EXPR = "{ NOT g.Upgrade5_Module_UPS_Download_Open }">
			<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ MvUPS_Download_Open_Store() }">
			<MvIF EXPR = "{ NOT l.opened }">
				<MvCOMMENT>
				|
				| Not a fatal error because the user may not have downloaded the tables/services
				|
				</MvCOMMENT>

				<MvFUNCTIONRETURN VALUE = 1>
			</MvIF>

			<MvASSIGN NAME = "g.Upgrade5_Module_UPS_Download_Open" VALUE = 1>
		</MvIF>

		<MvGO NAME = "UPS_Charges" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "UPS_Charges" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_UPS_Charges_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "UPS_Charges" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ UPS_Charges.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvFIND NAME = "MvUPSCharges" VALUE = "{ UPS_Charges.d.id }" EXACT>
	<MvIF EXPR = "{ NOT MvUPSCharges.d.EOF }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Charge code="' $ UPS_Charges.d.name $ '" />' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_UPS_EnabledCharges_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Enabled_Charges>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PTBS" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "products">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_PTBS_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ PTBS_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_PTBS_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_PTBS_Methods( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'products' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_PTBS_Products( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PTBS_Methods" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "breaks">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method_end">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_PTBS_Methods_Open }">
		<MvGO NAME = "PTBS_Methods" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "PTBS_Methods" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_PTBS_Methods_Open" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvSKIP NAME = "PTBS_Methods" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ PTBS_Methods.d.EOF }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>

		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method_start' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_PTBS_Method_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'breaks' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_PTBS_Breaks( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_PTBS_Method_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PTBS_Method_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Method_Add>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method>'						$ PTBS_Methods.d.method				$ '</Method>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Handling>'						$ PTBS_Methods.d.handling			$ '</Handling>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PTBS_Breaks" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_Module_PTBS_Breaks_Method NE PTBS_Methods.d.id }">
		<MvFIND NAME = "PTBS_Breaks" VALUE = "{ PTBS_Methods.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_Module_PTBS_Breaks_Method"	VALUE = "{ PTBS_Methods.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "PTBS_Breaks" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "PTBS_Breaks" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( PTBS_Breaks.d.EOF ) OR ( PTBS_Breaks.d.method_id NE PTBS_Methods.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Range>' ) }">

	<MvIF EXPR = "{ PTBS_Breaks.d.ceiling EQ 9999999999.00 }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Ceiling>+</Ceiling>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Ceiling>'		$ PTBS_Breaks.d.ceiling				$ '</Ceiling>' ) }">
	</MvIF>
	
	<MvIF EXPR = "{ PTBS_Breaks.d.percent }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Rate percent>'	$ PTBS_Breaks.d.rate				$ '</Rate>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Rate>'			$ PTBS_Breaks.d.rate				$ '</Rate>' ) }">
	</MvIF>
	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				</Range>' ) }">	

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PTBS_Method_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Method_Add>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_PTBS_Products" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_PTBS_Products_Open }">
		<MvGO NAME = "PTBS_Products" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "PTBS_Products" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_PTBS_Products_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "PTBS_Products" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ PTBS_Products.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvFIND NAME = "PTBS_Methods" VALUE = "{ PTBS_Products.d.method_id }" EXACT>
	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.product_found" VALUE = "{ Product_Find_ID( PTBS_Products.d.product_id ) }">

	<MvIF EXPR = "{ l.product_found AND ( NOT PTBS_Methods.d.EOF ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Product_Add method="' $ PTBS_Methods.d.method $ '" product_code="' $ Products.d.code $ '" rate="' $ PTBS_Products.d.rate $ '" />' ) }">	
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_QuantShip" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "quantities">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method_end">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_QuantShip_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ QuantShip_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "QuantShipMethods" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "QuantShipMethods" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_QuantShip_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvSKIP NAME = "QuantShipMethods" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ QuantShipMethods.d.EOF }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>

		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method_start' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_QuantShip_Method_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'quantities' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_QuantShip_Quantities( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_QuantShip_Method_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_QuantShip_Method_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Method_Add>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method>'		$ QuantShipMethods.d.method						$ '</Method>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Progressive>'	$ Upgrade5_Boolean( QuantShipMethods.d.prog )	$ '</Progressive>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_QuantShip_Quantities" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_Module_QuantShipQuantities_Method NE QuantShipMethods.d.id }">
		<MvFIND NAME = "QuantShipQuantities" VALUE = "{ QuantShipMethods.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_Module_QuantShipQuantities_Method"	VALUE = "{ QuantShipMethods.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "QuantShipQuantities" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "QuantShipQuantities" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( QuantShipQuantities.d.EOF ) OR ( QuantShipQuantities.d.method_id NE QuantShipMethods.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Range>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Floor>'			$ QuantShipQuantities.d.floor		$ '</Floor>' ) }">

	<MvIF EXPR = "{ QuantShipQuantities.d.ceiling EQ 0 }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Ceiling>+</Ceiling>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Ceiling>'			$ QuantShipQuantities.d.ceiling		$ '</Ceiling>' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Rate>'				$ QuantShipQuantities.d.unit_rate	$ '</Rate>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				</Range>' ) }">	

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_QuantShip_Method_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Method_Add>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_WTBS" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "methods">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "products">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_WTBS_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ WTBS_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_WTBS_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'methods' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_WTBS_Methods( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'products' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_WTBS_Products( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_WTBS_Methods" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "breaks">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "method_end">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_WTBS_Methods_Open }">
		<MvGO NAME = "WTBS_Methods" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "WTBS_Methods" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_WTBS_Methods_Open" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvSKIP NAME = "WTBS_Methods" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ WTBS_Methods.d.EOF }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>

		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method_start' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_WTBS_Method_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'breaks' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_WTBS_Breaks( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'method_end' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_WTBS_Method_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_WTBS_Method_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Method_Add>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Method>'	$ WTBS_Methods.d.method		$ '</Method>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Handling>'	$ WTBS_Methods.d.handling	$ '</Handling>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_WTBS_Breaks" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_Module_WTBS_Breaks_Method NE WTBS_Methods.d.id }">
		<MvFIND NAME = "WTBS_Breaks" VALUE = "{ WTBS_Methods.d.id $ ':' }">

		<MvASSIGN NAME = "g.Upgrade5_Module_WTBS_Breaks_Method"	VALUE = "{ WTBS_Methods.d.id }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "WTBS_Breaks" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "WTBS_Breaks" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( WTBS_Breaks.d.EOF ) OR ( WTBS_Breaks.d.method_id NE WTBS_Methods.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Range>' ) }">

	<MvIF EXPR = "{ WTBS_Breaks.d.ceiling EQ 9999999999.00 }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Ceiling>+</Ceiling>' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Ceiling>'	$ WTBS_Breaks.d.ceiling				$ '</Ceiling>' ) }">
	</MvIF>
	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '					<Rate>'			$ WTBS_Breaks.d.rate				$ '</Rate>' ) }">
	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				</Range>' ) }">	

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_WTBS_Method_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Method_Add>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_WTBS_Products" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_WTBS_Products_Open }">
		<MvGO NAME = "WTBS_Products" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "WTBS_Products" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_WTBS_Products_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "WTBS_Products" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ WTBS_Products.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvFIND NAME = "WTBS_Methods" VALUE = "{ WTBS_Products.d.method_id }" EXACT>
	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.product_found" VALUE = "{ Product_Find_ID( WTBS_Products.d.product_id ) }">

	<MvIF EXPR = "{ l.product_found AND ( NOT WTBS_Methods.d.EOF ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Product_Add method="' $ WTBS_Methods.d.method $ '" product_code="' $ Products.d.code $ '" rate="' $ WTBS_Products.d.rate $ '" />' ) }">	
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_CanVat" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "provinces">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "products">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_CanVat_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ CanVat_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_CanVat_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_CanVat_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'provinces' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_CanVat_Provinces( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'products' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_CanVat_Products( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																					<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_CanVat_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<GST>'			$ CanVatGST.d.gst							$ '</GST>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<HST>'			$ CanVatGST.d.hst							$ '</HST>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TaxShipping>'	$ Upgrade5_Boolean( CanVatGST.d.tax_ship )	$ '</TaxShipping>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_CanVat_Provinces" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_CanVat_Open }">
		<MvGO NAME = "CanVat" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "CanVat" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_CanVat_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "CanVat" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ CanVat.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ CanVat.d.type EQ 'hst' }">
		<MvASSIGN NAME = "l.hst" 	VALUE = "Yes">
	<MvELSE>
		<MvASSIGN NAME = "l.hst" 	VALUE = "No">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Province_Add>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Code>'			$ CanVat.d.name				$ '</Code>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Type>'			$ toupper( CanVat.d.type )	$ '</Type>' ) }">

	<MvIF EXPR = "{ CanVat.d.type EQ 'pst' }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<PST>'		$ CanVat.d.pst				$ '</PST>' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TaxShipping>'	$ Upgrade5_Boolean( CanVat.d.tax_ship )	$ '</TaxShipping>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TaxGST>'		$ Upgrade5_Boolean( CanVat.d.tax_gst )	$ '</TaxGST>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Province_Add>' ) }">	

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_CanVat_Products" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_CanVatProducts_Open }">
		<MvGO NAME = "CanVatProducts" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "CanVatProducts" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_CanVatProducts_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "CanVatProducts" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ CanVatProducts.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.product_found" VALUE = "{ Product_Find_ID( CanVatProducts.d.product_id ) }">
	<MvIF EXPR = "{ l.product_found }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Product_Add>' ) }">	
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Code>'			$ Products.d.code									$ '</Code>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<GSTExempt>'	$ Upgrade5_Boolean( CanVatProducts.d.gst_exempt )	$ '</GSTExempt>' ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<PSTExempt>'	$ Upgrade5_Boolean( CanVatProducts.d.pst_exempt )	$ '</PSTExempt>' ) }">	
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Product_Add>' ) }">	
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_CertiTAX" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ CertiTAX_Open_Store() }">
	<MvIF EXPR = "{ NOT l.opened }">
		<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
	</MvIF>

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Serial>'				$ CertiTax.d.serial							$ '</Serial>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ValidateAddresses>'	$ Upgrade5_Boolean( CertiTax.d.addresses )	$ '</ValidateAddresses>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ItemLevelCalculation>'	$ Upgrade5_Boolean( CertiTax.d.line_items )	$ '</ItemLevelCalculation>' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_DEVAT" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "options">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "rates_start">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "rates">				<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "rates_end">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "countries_start">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "countries">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "countries_end">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "products">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_DEVAT_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ DEVAT_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_DEVAT_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'options' }">						<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_DEVAT_Options( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'rates_start' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_DEVAT_Rates_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'rates' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_DEVAT_Rates( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'rates_end' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_DEVAT_Rates_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'products' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_DEVAT_Products( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'countries_start' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_DEVAT_Countries_Start( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'countries' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_DEVAT_Countries( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'countries_end' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_DEVAT_Countries_End( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																						<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_DEVAT_Options" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<PriceIncludesVAT>'		$ Upgrade5_Boolean( DEVAT_Options.d.inclds_vat )	$ '</PriceIncludesVAT>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<ShippingIncludesVAT>'	$ Upgrade5_Boolean( DEVAT_Options.d.ship_incld )	$ '</ShippingIncludesVAT>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TaxShipping>'			$ Upgrade5_Boolean( DEVAT_Options.d.tax_ship )		$ '</TaxShipping>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_DEVAT_Rates_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Rates>' ) }">	
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_DEVAT_Rates" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_DEVAT_Rates_Open }">
		<MvGO NAME = "DEVAT_Rates" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "DEVAT_Rates" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_DEVAT_Rates_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "DEVAT_Rates" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ DEVAT_Rates.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvIF EXPR = "{ len( DEVAT_Rates.d.desc ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Rate percent="' $ DEVAT_Rates.d.rate $ '">' $ DEVAT_Rates.d.desc $ '</Rate>' ) }">	
	<MvELSE>
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Rate percent="' $ DEVAT_Rates.d.rate $ '" />' ) }">	
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_DEVAT_Rates_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Rates>' ) }">	
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_DEVAT_Countries_Start" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Countries>' ) }">	
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_DEVAT_Countries" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_DEVAT_Countries_Open }">
		<MvGO NAME = "DEVAT_Countries" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "DEVAT_Countries" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_DEVAT_Countries_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "DEVAT_Countries" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ DEVAT_Countries.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Country code="' $ DEVAT_Countries.d.cty_alpha $ '" />' ) }">

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_DEVAT_Countries_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Countries>' ) }">	
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_DEVAT_Products" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_DEVAT_Products_Open }">
		<MvGO NAME = "DEVAT_Products" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "DEVAT_Products" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_DEVAT_Products_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "DEVAT_Products" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ DEVAT_Products.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.product_found" VALUE = "{ Product_Find_ID( DEVAT_Products.d.product_id ) }">
	<MvFIND NAME = "DEVAT_Rates" VALUE = "{ DEVAT_Products.d.rate_id }" EXACT>

	<MvIF EXPR = "{ l.product_found AND ( NOT DEVAT_Rates.d.EOF ) }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Product_Add code="' $ Products.d.code $ '" rate="' $ DEVAT_Rates.d.rate $ '" />' ) }">	
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_ShopTax" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "rates">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_ShopTax_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ ShopTax_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_ShopTax_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_ShopTax_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'rates' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_ShopTax_Rates( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>				l																<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_ShopTax_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Prompt>'	$ ShopTax.d.prompt	$ '</Prompt>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_ShopTax_Rates" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_ShopTaxRates_Open }">
		<MvGO NAME = "ShopTaxRates" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "ShopTaxRates" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_ShopTaxRates_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "ShopTaxRates" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ShopTaxRates.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Rate_Add>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Prompt>'		$ ShopTaxRates.d.prompt							$ '</Prompt>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Rate>'			$ ShopTaxRates.d.rate							$ '</Rate>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TaxShipping>'	$ Upgrade5_Boolean( ShopTaxRates.d.tax_ship )	$ '</TaxShipping>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Rate_Add>' ) }">	

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_StateTax" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "settings">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "states">			<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_StateTax_Opened }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ StateTax_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_StateTax_Opened" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'settings' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_StateTax_Settings( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'states' }">		<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_StateTax_States( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																				<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_StateTax_Settings" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Settings>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TaxState>'	$ StateTax_TaxState( StateTaxOptions.d.taxstate )	$ '</TaxState>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</Settings>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "StateTax_TaxState" PARAMETERS = "taxstate" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.taxstate EQ 'S' }">	<MvFUNCTIONRETURN VALUE = "Shipping">
	<MvELSE>								<MvFUNCTIONRETURN VALUE = "Billing">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_StateTax_States" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_StateTax_Open }">
		<MvGO NAME = "StateTax" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "StateTax" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_StateTax_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "StateTax" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ StateTax.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<State_Add>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<State>'		$ StateTax.d.state							$ '</State>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Rate>'			$ StateTax.d.rate							$ '</Rate>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<TaxShipping>'	$ Upgrade5_Boolean( StateTax.d.tax_ship )	$ '</TaxShipping>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</State_Add>' ) }">	

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_VAT" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_VAT_Open }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ VAT_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvGO NAME = "VAT" ROW = "top">
		
		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "VAT" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_VAT_Open" VALUE = 1>
	<MvELSE>
		<MvSKIP NAME = "VAT" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ VAT.d.EOF }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvDO FILE = "{ g.Module_Library_DB }" NAME = "l.product_found" VALUE = "{ Product_Find_ID( VAT.d.product_id ) }">
	<MvIF EXPR = "{ l.product_found }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<Product code="' $ Products.d.code $ '" rate="' $ VAT.d.rate $ '" />' ) }">	
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_KCUI" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_CustomFields" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "product_fields">		<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "customer_fields">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'product_fields' }">				<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_CustomFields_ProductFields( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'customer_fields' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_CustomFields_CustomerFields( l.step:substeps[ l.step:substep_pos ] ) }">>
	<MvELSE>																						<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_CustomFields_ProductFields" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "field">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "values">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_CustomFields_ProductFields_Open }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ Custom_ProductFields_Open_Store() AND Custom_ProductValues_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "CustomProductFields" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_CustomFields_ProductFields_Open" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvSKIP NAME = "CustomProductFields" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ CustomProductFields.d.EOF }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>

		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'field' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_CustomFields_ProductField( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'values' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_CustomFields_ProductFieldValues( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																			<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_CustomFields_ProductField" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ProductField_Add>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Code>'		$ CustomProductFields.d.code	$ '</Code>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Name>'		$ CustomProductFields.d.name	$ '</Name>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</ProductField_Add>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_CustomFields_ProductFieldValues" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_Module_CustomFields_ProductField NE CustomProductFields.d.code }">
		<MvFIND NAME = "CustomProductFieldValues" VALUE = "{ CustomProductFields.d.id }" EXACT>

		<MvASSIGN NAME = "g.Upgrade5_Module_CustomFields_ProductField"	VALUE = "{ CustomProductFields.d.code }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "CustomProductFieldValues" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "CustomProductFieldValues" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( CustomProductFieldValues.d.EOF ) OR ( CustomProductFieldValues.d.field_id NE CustomProductFields.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvFIND NAME = "Products" VALUE = "{ CustomProductFieldValues.d.product_id }" EXACT>
	<MvIF EXPR = "{ NOT Products.d.EOF }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<ProductField_Value product="' $ Products.d.code $ '" field="' $ CustomProductFields.d.code $ '"><![CDATA[' $ CustomProductFieldValues.d.value $ ']]></ProductField_Value>' ) }">	
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_CustomFields_CustomerFields" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:substep_count"		VALUE = 0>

		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "field">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">
		<MvASSIGN NAME = "l.step:substeps" INDEX = "{ l.step:substep_count + 1 }" MEMBER = "code" VALUE = "values">	<MvASSIGN NAME = "l.step:substep_count" VALUE = "{ l.step:substep_count + 1 }">

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT g.Upgrade5_Module_CustomFields_CustomerFields_Open }">
		<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.opened" VALUE = "{ Custom_CustomerFields_Open_Store() AND Custom_CustomerValues_Open_Store() }">
		<MvIF EXPR = "{ NOT l.opened }">
			<MvFUNCTIONRETURN VALUE = "{ Upgrade5_Error() }">
		</MvIF>

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "CustomCustomerFields" ROWS = "{ l.step:offset }">
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Module_CustomFields_CustomerFields_Open" VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvSKIP NAME = "CustomCustomerFields" ROWS = 1>

		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvASSIGN NAME = "l.step:offset"		VALUE = "{ l.step:offset + 1 }">
	</MvIF>

	<MvIF EXPR = "{ CustomCustomerFields.d.EOF }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>

		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substep_pos GT l.step:substep_count }">
		<MvASSIGN NAME = "l.step:substep_pos"	VALUE = 1>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'field' }">			<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_CustomFields_CustomerField( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE> <MvIF EXPR = "{ l.step:substeps[ l.step:substep_pos ]:code EQ 'values' }">	<MvASSIGN NAME = "l.result" VALUE = "{ Upgrade5_Step_Module_CustomFields_CustomerFieldValues( l.step:substeps[ l.step:substep_pos ] ) }">
	<MvELSE>																			<MvASSIGN NAME = "l.result" VALUE = -1>
	</MvIF> </MvIF>

	<MvIF EXPR = "{ l.result EQ -1 }">
		<MvFUNCTIONRETURN VALUE = -1>
	<MvELSE> <MvIF EXPR = "{ l.result EQ 1 }">
		<MvASSIGN NAME = "l.step:substep_pos" VALUE = "{ l.step:substep_pos + 1 }">
	</MvIF> </MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_CustomFields_CustomerField" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<CustomerField_Add>' ) }">	
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Code>'		$ CustomCustomerFields.d.code	$ '</Code>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '				<Name>'		$ CustomCustomerFields.d.name	$ '</Name>' ) }">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			</CustomerField_Add>' ) }">	

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_CustomFields_CustomerFieldValues" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:offset"		VALUE = 0>
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ g.Upgrade5_Module_CustomFields_CustomerField NE CustomCustomerFields.d.code }">
		<MvFIND NAME = "CustomCustomerFieldValues" VALUE = "{ CustomCustomerFields.d.id }" EXACT>

		<MvASSIGN NAME = "g.Upgrade5_Module_CustomFields_CustomerField"	VALUE = "{ CustomCustomerFields.d.code }">

		<MvIF EXPR = "{ l.step:offset }">
			<MvSKIP NAME = "CustomCustomerFieldValues" ROWS = "{ l.step:offset }">
		</MvIF>
	<MvELSE>
		<MvSKIP NAME = "CustomCustomerFieldValues" ROWS = 1>
	</MvIF>

	<MvIF EXPR = "{ ( CustomCustomerFieldValues.d.EOF ) OR ( CustomCustomerFieldValues.d.field_id NE CustomCustomerFields.d.id ) }">
		<MvASSIGN NAME = "l.step:offset"	VALUE = 0>
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.step:offset"			VALUE = "{ l.step:offset + 1 }">

	<MvFIND NAME = "Customers" VALUE = "{ CustomCustomerFieldValues.d.cust_id }" EXACT>
	<MvIF EXPR = "{ NOT Customers.d.EOF }">
		<MvEVAL EXPR = "{ Upgrade5_Export_Line( '			<CustomerField_Value customer="' $ Customers.d.login $ '" field="' $ CustomCustomerFields.d.code $ '"><![CDATA[' $ CustomCustomerFieldValues.d.value $ ']]></CustomerField_Value>' ) }">	
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_Unknown" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT l.step:initialized }">
		<MvASSIGN NAME = "l.step:initialized"	VALUE = 1>

		<MvIF EXPR = "{ NOT sexists( g.Module_Root $ Modules.d.module ) }">
			<MvASSIGN NAME = "l.step:skip"		VALUE = 1>
		<MvELSE>
			<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.api_version" VALUE = "{ Module_API_Version() }">
			<MvIF EXPR = "{ l.api_version LT 4.25 }">
				<MvASSIGN NAME = "l.step:skip"	VALUE = 1>
			</MvIF>
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ l.step:skip }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvDO FILE = "{ g.Module_Root $ Modules.d.module }" NAME = "l.result" VALUE = "{ Module_Upgrade5_Export( l.step:module_data ) }">
	<MvFUNCTIONRETURN VALUE = "{ l.result }">
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Module_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '		</Module>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Store_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '	</Store>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Step_Provision_End" PARAMETERS = "step var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Upgrade5_Export_Line( '</Provision>' ) }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Export_Line" PARAMETERS = "line" STANDARDOUTPUTLEVEL = "">
	<MvEXPORT FILE = "{ g.Upgrade5_File }" DELIMITER = "" FIELDS = "l.line">
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Error" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = -1>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Boolean" PARAMETERS = "value" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.value }">
		<MvFUNCTIONRETURN VALUE = "Yes">
	<MvELSE>
		<MvFUNCTIONRETURN VALUE = "No">	
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "Upgrade5_Status" PARAMETERS = "step, offset, totrec" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ ( s.dyn_time_t GT g.Upgrade5_Last_Status ) OR
					( l.step NE g.Upgrade5_Last_Step ) }">
		<MvEVAL EXPR = "{ '<script language="JavaScript">' $ 
						  'if ( parent.Info.loaded ) parent.Info.Upgrade5_Draw_Status( parent.Progress.document, \'' $ JavaScriptEncode( l.step ) $ '\', ' $ l.offset $ ', ' $ l.totrec $ ' );' $
						  '</script>' }">
		<MvIF EXPR = "{ s.mivaversion GE 4.00 }">
			<MvEVAL EXPR = "{ miva_output_flush() }">
		<MvELSE>
			<MvIF EXPR = "{ g.Upgrade5_Last_Status }">
				<MvASSIGN NAME = "g.Upgrade5_Flush"		VALUE = 1>
			</MvIF>
		</MvIF>

		<MvASSIGN NAME = "g.Upgrade5_Last_Status"	VALUE = "{ s.dyn_time_t }">
		<MvASSIGN NAME = "g.Upgrade5_Last_Step"		VALUE = "{ l.step }">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptEncode" PARAMETERS = "field" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ glosub( encodeentities( l.field ), '\'', '\\\'' ) }">
</MvFUNCTION>
